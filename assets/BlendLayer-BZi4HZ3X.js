import{eH as Qe,cL as Ve,s as x,eI as We,eJ as tr,eK as er,eL as rr,cj as nr,X as Z,Z as At,a2 as ar}from"./index-DMwY2Yeh.js";import{e as Et}from"./mat4f32-DcsiF_Rp.js";import{r as J,s as P}from"./mat4-DsYZliz4.js";const sr=(e,n)=>{const a=J(e,n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1);return P(a,a)},or=(e,n)=>{const a=J(e,n,0,0,.5-.5*n,0,n,0,.5-.5*n,0,0,n,.5-.5*n,0,0,0,1);return P(a,a)},ur=(e,n)=>{const a=1-n,t=J(e,.2126+.7874*a,.7152-.7152*a,.0722-.0722*a,0,.2126-.2126*a,.7152+.2848*a,.0722-.0722*a,0,.2126-.2126*a,.7152-.7152*a,.0722+.9278*a,0,0,0,0,1);return P(t,t)},ir=(e,n)=>{const a=Math.sin(n*Math.PI/180),t=Math.cos(n*Math.PI/180),f=J(e,.213+.787*t-.213*a,.715-.715*t-.715*a,.072-.072*t+.928*a,0,.213-.213*t+.143*a,.715+.285*t+.14*a,.072-.072*t-.283*a,0,.213-.213*t-.787*a,.715-.715*t+.715*a,.072+.928*t+.072*a,0,0,0,0,1);return P(f,f)},cr=(e,n)=>{const a=1-2*n,t=J(e,a,0,0,n,0,a,0,n,0,0,a,n,0,0,0,1);return P(t,t)},lr=(e,n)=>{const a=J(e,.213+.787*n,.715-.715*n,.072-.072*n,0,.213-.213*n,.715+.285*n,.072-.072*n,0,.213-.213*n,.715-.715*n,.072+.928*n,0,0,0,0,1);return P(a,a)},fr=(e,n)=>{const a=1-n,t=J(e,.393+.607*a,.769-.769*a,.189-.189*a,0,.349-.349*a,.686+.314*a,.168-.168*a,0,.272-.272*a,.534-.534*a,.131+.869*a,0,0,0,0,1);return P(t,t)};let kt=class Ot{constructor(n,a,t){this.strength=n,this.radius=a,this.threshold=t,this.type="bloom"}interpolate(n,a,t){this.strength=A(n.strength,a.strength,t),this.radius=A(n.radius,a.radius,t),this.threshold=A(n.threshold,a.threshold,t)}clone(){return new Ot(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:L(this.radius),strength:this.strength,threshold:this.threshold}}},Nt=class Rt{constructor(n){this.radius=n,this.type="blur"}interpolate(n,a,t){this.radius=Math.round(A(n.radius,a.radius,t))}clone(){return new Rt(this.radius)}toJSON(){return{type:"blur",radius:L(this.radius)}}};class B{constructor(n,a){this.type=n,this.amount=a,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(n,a,t){this.amount=A(n.amount,a.amount,t),this._updateMatrix()}clone(){return new B(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const n=this._colorMatrix||Et();switch(this.type){case"brightness":this._colorMatrix=sr(n,this.amount);break;case"contrast":this._colorMatrix=or(n,this.amount);break;case"grayscale":this._colorMatrix=ur(n,this.amount);break;case"invert":this._colorMatrix=cr(n,this.amount);break;case"saturate":this._colorMatrix=lr(n,this.amount);break;case"sepia":this._colorMatrix=fr(n,this.amount)}}}let St=class _t{constructor(n,a,t,f){this.offsetX=n,this.offsetY=a,this.blurRadius=t,this.color=f,this.type="drop-shadow"}interpolate(n,a,t){this.offsetX=A(n.offsetX,a.offsetX,t),this.offsetY=A(n.offsetY,a.offsetY,t),this.blurRadius=A(n.blurRadius,a.blurRadius,t),this.color[0]=Math.round(A(n.color[0],a.color[0],t)),this.color[1]=Math.round(A(n.color[1],a.color[1],t)),this.color[2]=Math.round(A(n.color[2],a.color[2],t)),this.color[3]=A(n.color[3],a.color[3],t)}clone(){return new _t(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const n=[...this.color];return n[3]*=255,{type:"drop-shadow",xoffset:L(this.offsetX),yoffset:L(this.offsetY),blurRadius:L(this.blurRadius),color:n}}},jt=class Jt{constructor(n){this.angle=n,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(n,a,t){this.angle=A(n.angle,a.angle,t),this._updateMatrix()}clone(){return new Jt(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const n=this._colorMatrix||Et();this._colorMatrix=ir(n,this.angle)}},Pt=class It{constructor(n){this.amount=n,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(n,a,t){this.amount=A(n.amount,a.amount,t)}clone(){return new It(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function A(e,n,a){return e+(n-e)*a}function L(e){return Math.round(1e3*Ve(e))/1e3}function hr(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new B(e.type,0);case"saturate":case"brightness":case"contrast":return new B(e.type,1);case"opacity":return new Pt(1);case"hue-rotate":return new jt(0);case"blur":return new Nt(0);case"drop-shadow":return new St(0,0,0,[...Qe("transparent")]);case"bloom":return new kt(0,0,1)}}function pr(e,n){const a=e.length>n.length?e:n;return(e.length>n.length?n:e).every((t,f)=>t.type===a[f].type)}function mr(e,n){const a=e.length>n.length?e:n,t=e.length>n.length?n:e;for(let f=t.length;f<a.length;f++)t.push(hr(a[f]))}function gr(e){const n=e[0];return!!n&&"type"in n}function dr(e,n){function a(){this.constructor=e}a.prototype=n.prototype,e.prototype=new a}function q(e,n,a,t){var f=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(f,q.prototype),f.expected=n,f.found=a,f.location=t,f.name="SyntaxError",f}function Q(e,n,a){return a=a||" ",e.length>n?e:(n-=e.length,e+(a+=a.repeat(n)).slice(0,n))}function yr(e,n){var a,t={},f=(n=n!==void 0?n:{}).grammarSource,F={start:xt},_=xt,j="none",I=")",p=",",d="(",C="%",v="px",et="cm",rt="mm",nt="in",at="pt",st="pc",ot="deg",ut="rad",it="grad",ct="turn",Yt="#",zt=".",Lt="e",lt=/^[ \t\n\r]/,ft=/^[a-z\-]/,ht=/^[0-9a-fA-F]/,pt=/^[+\-]/,R=/^[0-9]/,Bt=O("none"),Tt=w("none",!1),Dt=w(")",!1),mt=w(",",!1),Ut=O("whitespace"),gt=z([" ","	",`
`,"\r"],!1,!1),Gt=O("function"),Ht=w("(",!1),Kt=O("identifier"),dt=z([["a","z"],"-"],!1,!1),Zt=O("percentage"),Qt=w("%",!1),Vt=O("length"),Wt=w("px",!1),te=w("cm",!1),ee=w("mm",!1),re=w("in",!1),ne=w("pt",!1),ae=w("pc",!1),se=O("angle"),oe=w("deg",!1),ue=w("rad",!1),ie=w("grad",!1),ce=w("turn",!1),le=O("number"),fe=O("color"),he=w("#",!1),yt=z([["0","9"],["a","f"],["A","F"]],!1,!1),vt=z(["+","-"],!1,!1),S=z([["0","9"]],!1,!1),pe=w(".",!1),me=w("e",!1),ge=function(){return[]},de=function(r,o){return{type:"function",name:r,parameters:o||[]}},ye=function(r,o){return o.length>0?Ze(r,o,3):[r]},ve=function(r){return{type:"quantity",value:r.value,unit:r.unit}},we=function(r){return{type:"color",colorType:r.type,value:r.value}},be=function(r){return r},xe=function(){return U()},$e=function(r){return{value:r,unit:"%"}},Ae=function(r){return{value:r,unit:"px"}},Me=function(r){return{value:r,unit:"cm"}},Fe=function(r){return{value:r,unit:"mm"}},Ce=function(r){return{value:r,unit:"in"}},Ee=function(r){return{value:r,unit:"pt"}},ke=function(r){return{value:r,unit:"pc"}},Oe=function(r){return{value:r,unit:"deg"}},Ne=function(r){return{value:r,unit:"rad"}},Re=function(r){return{value:r,unit:"grad"}},Se=function(r){return{value:r,unit:"turn"}},_e=function(r){return{value:r,unit:null}},je=function(){return{type:"hex",value:U()}},Je=function(r){return{type:"function",value:r}},Pe=function(){return{type:"named",value:U()}},Ie=function(){return parseFloat(U())},s=0|n.peg$currPos,m=s,X=[{line:1,column:1}],E=s,D=n.peg$maxFailExpected||[],i=0|n.peg$silentFails;if(n.startRule){if(!(n.startRule in F))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');_=F[n.startRule]}function U(){return e.substring(m,s)}function w(r,o){return{type:"literal",text:r,ignoreCase:o}}function z(r,o,u){return{type:"class",parts:r,inverted:o,ignoreCase:u}}function Xe(){return{type:"end"}}function O(r){return{type:"other",description:r}}function wt(r){var o,u=X[r];if(u)return u;if(r>=X.length)o=X.length-1;else for(o=r;!X[--o];);for(u={line:(u=X[o]).line,column:u.column};o<r;)e.charCodeAt(o)===10?(u.line++,u.column=1):u.column++,o++;return X[r]=u,u}function bt(r,o,u){var c=wt(r),h=wt(o);return{source:f,start:{offset:r,line:c.line,column:c.column},end:{offset:o,line:h.line,column:h.column}}}function l(r){s<E||(s>E&&(E=s,D=[]),D.push(r))}function qe(r,o,u){return new q(q.buildMessage(r,o),r,o,u)}function xt(){var r;return(r=Ye())===t&&(r=ze()),r}function Ye(){var r,o;return i++,r=s,b(),e.substr(s,4)===j?(o=j,s+=4):(o=t,i===0&&l(Tt)),o!==t?(b(),m=r,r=ge()):(s=r,r=t),i--,r===t&&i===0&&l(Bt),r}function ze(){var r,o;if(r=[],(o=H())!==t)for(;o!==t;)r.push(o),o=H();else r=t;return r}function H(){var r,o,u,c;return r=s,b(),(o=Be())!==t?(b(),(u=Le())===t&&(u=null),b(),e.charCodeAt(s)===41?(c=I,s++):(c=t,i===0&&l(Dt)),c!==t?(b(),m=r,r=de(o,u)):(s=r,r=t)):(s=r,r=t),r}function Le(){var r,o,u,c,h,g,y,$;if(r=s,(o=K())!==t){for(u=[],c=s,h=b(),e.charCodeAt(s)===44?(g=p,s++):(g=t,i===0&&l(mt)),g===t&&(g=null),y=b(),($=K())!==t?c=h=[h,g,y,$]:(s=c,c=t);c!==t;)u.push(c),c=s,h=b(),e.charCodeAt(s)===44?(g=p,s++):(g=t,i===0&&l(mt)),g===t&&(g=null),y=b(),($=K())!==t?c=h=[h,g,y,$]:(s=c,c=t);m=r,r=ye(o,u)}else s=r,r=t;return r}function K(){var r,o;return r=s,(o=Te())===t&&(o=De())===t&&(o=Ue())===t&&(o=Ge()),o!==t&&(m=r,o=ve(o)),(r=o)===t&&(r=s,(o=He())!==t&&(m=r,o=we(o)),r=o),r}function b(){var r,o;for(i++,r=[],o=e.charAt(s),lt.test(o)?s++:(o=t,i===0&&l(gt));o!==t;)r.push(o),o=e.charAt(s),lt.test(o)?s++:(o=t,i===0&&l(gt));return i--,o=t,i===0&&l(Ut),r}function Be(){var r,o,u;return i++,r=s,(o=$t())!==t?(e.charCodeAt(s)===40?(u=d,s++):(u=t,i===0&&l(Ht)),u!==t?(m=r,r=be(o)):(s=r,r=t)):(s=r,r=t),i--,r===t&&(o=t,i===0&&l(Gt)),r}function $t(){var r,o,u;if(i++,r=s,o=[],u=e.charAt(s),ft.test(u)?s++:(u=t,i===0&&l(dt)),u!==t)for(;u!==t;)o.push(u),u=e.charAt(s),ft.test(u)?s++:(u=t,i===0&&l(dt));else o=t;return o!==t&&(m=r,o=xe()),i--,(r=o)===t&&(o=t,i===0&&l(Kt)),r}function Te(){var r,o,u;return i++,r=s,b(),(o=M())!==t?(e.charCodeAt(s)===37?(u=C,s++):(u=t,i===0&&l(Qt)),u!==t?(m=r,r=$e(o)):(s=r,r=t)):(s=r,r=t),i--,r===t&&i===0&&l(Zt),r}function De(){var r,o,u;return i++,r=s,b(),(o=M())!==t?(e.substr(s,2)===v?(u=v,s+=2):(u=t,i===0&&l(Wt)),u!==t?(m=r,r=Ae(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,b(),(o=M())!==t?(e.substr(s,2)===et?(u=et,s+=2):(u=t,i===0&&l(te)),u!==t?(m=r,r=Me(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,b(),(o=M())!==t?(e.substr(s,2)===rt?(u=rt,s+=2):(u=t,i===0&&l(ee)),u!==t?(m=r,r=Fe(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,b(),(o=M())!==t?(e.substr(s,2)===nt?(u=nt,s+=2):(u=t,i===0&&l(re)),u!==t?(m=r,r=Ce(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,b(),(o=M())!==t?(e.substr(s,2)===at?(u=at,s+=2):(u=t,i===0&&l(ne)),u!==t?(m=r,r=Ee(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,b(),(o=M())!==t?(e.substr(s,2)===st?(u=st,s+=2):(u=t,i===0&&l(ae)),u!==t?(m=r,r=ke(o)):(s=r,r=t)):(s=r,r=t)))))),i--,r===t&&i===0&&l(Vt),r}function Ue(){var r,o,u;return i++,r=s,(o=M())!==t?(e.substr(s,3)===ot?(u=ot,s+=3):(u=t,i===0&&l(oe)),u!==t?(m=r,r=Oe(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,(o=M())!==t?(e.substr(s,3)===ut?(u=ut,s+=3):(u=t,i===0&&l(ue)),u!==t?(m=r,r=Ne(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,(o=M())!==t?(e.substr(s,4)===it?(u=it,s+=4):(u=t,i===0&&l(ie)),u!==t?(m=r,r=Re(o)):(s=r,r=t)):(s=r,r=t),r===t&&(r=s,(o=M())!==t?(e.substr(s,4)===ct?(u=ct,s+=4):(u=t,i===0&&l(ce)),u!==t?(m=r,r=Se(o)):(s=r,r=t)):(s=r,r=t)))),i--,r===t&&(o=t,i===0&&l(se)),r}function Ge(){var r,o;return i++,r=s,b(),(o=M())!==t?(m=r,r=_e(o)):(s=r,r=t),i--,r===t&&i===0&&l(le),r}function He(){var r,o,u,c;if(i++,r=s,e.charCodeAt(s)===35?(o=Yt,s++):(o=t,i===0&&l(he)),o!==t){if(u=[],c=e.charAt(s),ht.test(c)?s++:(c=t,i===0&&l(yt)),c!==t)for(;c!==t;)u.push(c),c=e.charAt(s),ht.test(c)?s++:(c=t,i===0&&l(yt));else u=t;u!==t?(m=r,r=je()):(s=r,r=t)}else s=r,r=t;return r===t&&(r=s,(o=H())!==t&&(m=r,o=Je(o)),(r=o)===t&&(r=s,(o=$t())!==t&&(m=r,o=Pe()),r=o)),i--,r===t&&(o=t,i===0&&l(fe)),r}function M(){var r,o,u,c,h,g,y,$;for(r=s,o=e.charAt(s),pt.test(o)?s++:(o=t,i===0&&l(vt)),o===t&&(o=null),u=s,c=[],h=e.charAt(s),R.test(h)?s++:(h=t,i===0&&l(S));h!==t;)c.push(h),h=e.charAt(s),R.test(h)?s++:(h=t,i===0&&l(S));if(e.charCodeAt(s)===46?(h=zt,s++):(h=t,i===0&&l(pe)),h!==t){if(g=[],y=e.charAt(s),R.test(y)?s++:(y=t,i===0&&l(S)),y!==t)for(;y!==t;)g.push(y),y=e.charAt(s),R.test(y)?s++:(y=t,i===0&&l(S));else g=t;g!==t?u=c=[c,h,g]:(s=u,u=t)}else s=u,u=t;if(u===t)if(u=[],c=e.charAt(s),R.test(c)?s++:(c=t,i===0&&l(S)),c!==t)for(;c!==t;)u.push(c),c=e.charAt(s),R.test(c)?s++:(c=t,i===0&&l(S));else u=t;if(u!==t){if(c=s,e.charCodeAt(s)===101?(h=Lt,s++):(h=t,i===0&&l(me)),h!==t){if(g=e.charAt(s),pt.test(g)?s++:(g=t,i===0&&l(vt)),g===t&&(g=null),y=[],$=e.charAt(s),R.test($)?s++:($=t,i===0&&l(S)),$!==t)for(;$!==t;)y.push($),$=e.charAt(s),R.test($)?s++:($=t,i===0&&l(S));else y=t;y!==t?c=h=[h,g,y]:(s=c,c=t)}else s=c,c=t;c===t&&(c=null),m=r,r=Ie()}else s=r,r=t;return r}function Ke(r,o){return r.map(function(u){return u[o]})}function Ze(r,o,u){return[r].concat(Ke(o,u))}if(a=_(),n.peg$library)return{peg$result:a,peg$currPos:s,peg$FAILED:t,peg$maxFailExpected:D,peg$maxFailPos:E};if(a!==t&&s===e.length)return a;throw a!==t&&s<e.length&&l(Xe()),qe(D,E<e.length?e.charAt(E):null,E<e.length?bt(E,E+1):bt(E,E))}function Xt(e){if(!e||e.length===0)return null;if(typeof e=="string"){const a=Mt(e);return a&&a.length!==0?a:null}const n=e.map(a=>{if(!Number.isFinite(a.scale)||a.scale<=0)throw new x("effect:invalid-scale","scale must be finite and greater than 0",{stop:a});return{scale:a.scale,effects:Mt(a.value)}});n.sort((a,t)=>t.effects.length-a.effects.length);for(let a=0;a<n.length-1;a++){if(!pr(n[a].effects,n[a+1].effects))throw new x("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:n[a].effects,b:n[a+1].effects});mr(n[a].effects,n[a+1].effects)}return n.sort((a,t)=>t.scale-a.scale),n}function Mt(e){let n;if(!e)return[];try{n=yr(e)}catch(a){throw new x("effect:invalid-syntax","Invalid effect syntax",{value:e,error:a})}return n.map(a=>vr(a))}function vr(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return wr(e);case"opacity":return br(e);case"hue-rotate":return xr(e);case"blur":return $r(e);case"drop-shadow":return Ar(e);case"bloom":return Mr(e)}}catch(n){throw n.details.filter=e,n}throw new x("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function wr(e){let n=1;return Y(e.parameters,1),e.parameters.length===1&&(n=k(e.parameters[0])),new B(e.name,n)}function br(e){let n=1;return Y(e.parameters,1),e.parameters.length===1&&(n=k(e.parameters[0])),new Pt(n)}function xr(e){let n=0;return Y(e.parameters,1),e.parameters.length===1&&(n=Nr(e.parameters[0])),new jt(n)}function $r(e){let n=0;return Y(e.parameters,1),e.parameters.length===1&&(n=tt(e.parameters[0]),T(n,e.parameters[0])),new Nt(n)}function Ar(e){const n=[];let a=null;for(const t of e.parameters)if(t.type==="color"){if(n.length&&Object.freeze(n),a)throw new x("effect:type-error","Accepts only one color",{});a=Rr(t)}else{const f=tt(t);if(Object.isFrozen(n))throw new x("effect:type-error","<length> parameters not consecutive",{lengths:n});n.push(f),n.length===3&&T(f,t)}if(n.length<2||n.length>3)throw new x("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${n.length}}`,{lengths:n});return new St(n[0],n[1],n[2]||0,a||qt("black"))}function Mr(e){let n=1,a=0,t=0;return Y(e.parameters,3),e.parameters[0]&&(n=k(e.parameters[0])),e.parameters[1]&&(a=tt(e.parameters[1]),T(a,e.parameters[1])),e.parameters[2]&&(t=k(e.parameters[2])),new kt(n,a,t)}function Y(e,n){if(e.length>n)throw new x("effect:type-error",`Function supports up to ${n} parameters, Actual: ${e.length}`,{parameters:e})}function G(e){if(e.type==="color")return"<color>";if(e.unit){if(e.unit in W)return"<length>";if(e.unit in V)return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function T(e,n){if(e<0)throw new x("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:n})}function Fr(e){if(e.type!=="quantity"||e.unit!==null)throw new x("effect:type-error",`Expected <double>, Actual: ${G(e)}`,{term:e})}function Cr(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new x("effect:type-error",`Expected <double> or <percentage>, Actual: ${G(e)}`,{term:e})}dr(q,Error),q.prototype.format=function(e){var n="Error: "+this.message;if(this.location){var a,t=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){t=e[a].text.split(/\r\n|\n|\r/g);break}var f=this.location.start,F=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(f):f,_=this.location.source+":"+F.line+":"+F.column;if(t){var j=this.location.end,I=Q("",F.line.toString().length," "),p=t[f.line-1],d=(f.line===j.line?j.column:p.length+1)-f.column||1;n+=`
 --> `+_+`
`+I+` |
`+F.line+" | "+p+`
`+I+" | "+Q("",f.column-1," ")+Q("",d,"^")}else n+=`
 at `+_}return n},q.buildMessage=function(e,n){var a={literal:function(p){return'"'+f(p.text)+'"'},class:function(p){var d=p.parts.map(function(C){return Array.isArray(C)?F(C[0])+"-"+F(C[1]):F(C)});return"["+(p.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function t(p){return p.charCodeAt(0).toString(16).toUpperCase()}function f(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+t(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+t(d)})}function F(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+t(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+t(d)})}function _(p){return a[p.type](p)}function j(p){var d,C,v=p.map(_);if(v.sort(),v.length>0){for(d=1,C=1;d<v.length;d++)v[d-1]!==v[d]&&(v[C]=v[d],C++);v.length=C}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function I(p){return p?'"'+f(p)+'"':"end of input"}return"Expected "+j(e)+" but "+I(n)+" found."};const V={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Er(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&V[e.unit]!=null))throw new x("effect:type-error",`Expected <angle>, Actual: ${G(e)}`,{term:e})}const W={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function kr(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&W[e.unit]!=null))throw new x("effect:type-error",`Expected <length>, Actual: ${G(e)}`,{term:e})}function k(e){Cr(e);const n=e.value;return T(n,e),e.unit==="%"?.01*n:n}function Or(e){return Fr(e),T(e.value,e),e.value}function Nr(e){return Er(e),e.value*V[e.unit]||0}function tt(e){return kr(e),e.value*W[e.unit]||0}function Rr(e){switch(e.colorType){case"hex":return We(e.value);case"named":return qt(e.value);case"function":return jr(e.value)}}function qt(e){if(!tr(e))throw new x("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return er(e)}const Sr=/^rgba?/i,_r=/^hsla?/i;function jr(e){if(Y(e.parameters,4),Sr.test(e.name))return[k(e.parameters[0]),k(e.parameters[1]),k(e.parameters[2]),e.parameters[3]?k(e.parameters[3]):1];if(_r.test(e.name))return rr(Or(e.parameters[0]),k(e.parameters[1]),k(e.parameters[2]),e.parameters[3]?k(e.parameters[3]):1);throw new x("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Jr(e,n,a){var t;try{return Xr(e)}catch(f){(t=a==null?void 0:a.messages)==null||t.push(f)}return null}function Pr(e,n,a,t){try{const f=Ir(e);nr(a,f,n)}catch(f){t.messages&&t.messages.push(f)}}function Ir(e){const n=Xt(e);return n?gr(n)?n.map(a=>a.toJSON()):n.map(({scale:a,effects:t})=>({scale:a,value:t.map(f=>f.toJSON())})):null}function Xr(e){if(!e||e.length===0)return null;if(qr(e)){const n=[];for(const a of e)n.push({scale:a.scale,value:Ft(a.value)});return n}return Ft(e)}function qr(e){const n=e[0];return!!n&&"scale"in n}function Ft(e){if(!(e!=null&&e.length))return"";const n=[];for(const a of e){let t=[];switch(a.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":t=[N(a,"amount")];break;case"blur":t=[N(a,"radius","pt")];break;case"hue-rotate":t=[N(a,"angle","deg")];break;case"drop-shadow":t=[N(a,"xoffset","pt"),N(a,"yoffset","pt"),N(a,"blurRadius","pt"),Yr(a,"color")];break;case"bloom":t=[N(a,"strength"),N(a,"radius","pt"),N(a,"threshold")]}const f=`${a.type}(${t.filter(Boolean).join(" ")})`;Xt(f),n.push(f)}return n.join(" ")}function N(e,n,a){if(e[n]==null)throw new x("effect:missing-parameter",`Missing parameter '${n}' in ${e.type} effect`,{effect:e});return a?e[n]+a:""+e[n]}function Yr(e,n){if(e[n]==null)throw new x("effect:missing-parameter",`Missing parameter '${n}' in ${e.type} effect`,{effect:e});const a=e[n];return`rgba(${a[0]||0}, ${a[1]||0}, ${a[2]||0}, ${a[3]/255||0})`}const zr={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},Ct={read:{reader:Jr},write:{allowNull:!0,writer:Pr}},Lr={json:{read:!1,write:!1,origins:{"web-map":Ct,"portal-item":Ct}}},Ur=e=>{let n=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Z([At(zr)],n.prototype,"blendMode",void 0),Z([At(Lr)],n.prototype,"effect",void 0),n=Z([ar("esri.layers.mixins.BlendLayer")],n),n};export{Pr as a,Lr as b,Ur as l,Jr as n,zr as s};
