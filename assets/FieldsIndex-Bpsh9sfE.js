import{cr as b,cs as Z,bq as O,bk as $,ct as g,cu as _,be as q,bg as p,cv as f,t as z,s as B,cw as L,cc as x,cx as D,cy as I,cz as h,bj as R}from"./index-DMwY2Yeh.js";class c{}function C(t){return t instanceof b?t===c.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function U(t){return C(t)?c.instance:t}c.instance=new Z("Etc/UTC");function J(t){return"timeZone"in t}function k(t){return"timeZone"in t}function v(t){return"dateFieldsTimeZone"in t}const A=new Map;class m{static fromJSON(e){return new m(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new m(e.fields??[],w(e))}static fromLayerJSON(e){return new m(e.fields??[],w(e))}constructor(e=[],i){var l;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const n=[];for(const s of this.fields){const a=s==null?void 0:s.name,r=T(a);if(a&&r){const o=d(a);this._fieldsMap.set(a,s),this._fieldsMap.set(o,s),this._normalizedFieldsMap.set(r,s),n.push(`${o}:${s.type}:${(l=this._timeZoneByFieldName)==null?void 0:l.get(a)}`),O(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):$(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),g(s)||_(s)||(s.editable=s.editable==null||!!s.editable,s.nullable=s.nullable==null||!!s.nullable)}}n.sort(),this.uid=n.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)g(e)||_(e)||e.nullable||q(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(d(e))??this._normalizedFieldsMap.get(T(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(z.getLogger("esri.layers.support.FieldsIndex").error(new B("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),p):M.has(i.type)?f:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===f?c.instance:i===p?L.utcInstance:x(A,i,()=>Z.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return D(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var i;return((i=this.get(e))==null?void 0:i.name)??void 0}toJSON(){return{fields:this.fields.map(e=>I(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function d(t){return t.trim().toLowerCase()}function T(t){var e;return((e=R(t))==null?void 0:e.toLowerCase())??""}const M=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function w(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:n,editFieldsInfo:l}=t,s=(n?"startField"in n?n.startField:n.startTimeField:"")??"",a=(n?"endField"in n?n.endField:n.endTimeField:"")??"",r=v(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?h(t.dateFieldsTimeReference):null,o=l?J(l)?l.timeZone??r:l.dateFieldsTimeReference?h(l.dateFieldsTimeReference):r??p:null,y=n?k(n)?n.timeZone??r:n.timeReference?h(n.timeReference):r:null,N=new Map([[d((l==null?void 0:l.creationDateField)??""),o],[d((l==null?void 0:l.editDateField)??""),o],[d(s),y],[d(a),y]]);for(const{name:u,type:F}of t.fields)if(M.has(F))e.set(u,f);else if(F!=="date"&&F!=="esriFieldTypeDate")e.set(u,null);else if(i)e.set(u,f);else{const S=N.get(d(u??""))??r;e.set(u,S)}return e}export{m as Z,U as i,C as r,c as t};
