import{t as N,s as ie,M as f,fx as fe,aD as w,a5 as he,B as me,C as be,U as Y,cO as ge,fy as ve,fz as we,dv as F,X as i,Z as l,a0 as ee,a2 as M,cn as xe,P as T,fA as Se,m as X,l as $e,aK as A,cD as Ie,ap as Q,y as oe,fB as Me,eE as ne,aM as Ce,dZ as je,T as Oe}from"./index-BdXiYUWp.js";import{v as q,p as V,j as Ee,n as Ne,c as Pe,b as Re,d as Ve,m as ke,z as le,A as ae}from"./UniqueValueRenderer-B2SL9Qlr.js";import{e as De}from"./LRUCache-C1crbGkZ.js";import{r as Te}from"./Version-CbmqbzHg.js";import{Z as _e}from"./FieldsIndex-C2YFsm16.js";import{c as Le}from"./colorUtils-C14RyZjC.js";import{B as Fe,W as te,U as Ae,v as qe,a as He,c as ze,z as Ge,J as Be,R as Ue}from"./diffUtils-BNnLMjfO.js";import{B as Je,H as Ze,D as Ke,C as We,a as Xe,e as Qe,c as Ye}from"./heatmapUtils-BHUsg2yN.js";import{a as et}from"./RendererLegendOptions-CSIkgEnl.js";function tt(t,e,s,r,n){if(t==null)return null;const o=t.referencesGeometry()&&n?st(e,r,n):e,a=t.repurposeFeature(o);try{return t.evaluate({...s,$feature:a},t.services)}catch(u){return N.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",u),null}}const z=new Map;function st(t,e,s){const{transform:r,hasZ:n,hasM:o}=s;z.has(e)||z.set(e,rt(e));const a=z.get(e)(t.geometry,r,n,o);return{...t,geometry:a}}function rt(t){const e={};switch(t){case"esriGeometryPoint":return(s,r,n,o)=>We(r,e,s,n,o);case"esriGeometryPolygon":return(s,r,n,o)=>Ke(r,e,s,n,o);case"esriGeometryPolyline":return(s,r,n,o)=>Ze(r,e,s,n,o);case"esriGeometryMultipoint":return(s,r,n,o)=>Je(r,e,s,n,o);default:return N.getLogger("esri.views.2d.support.arcadeOnDemand").error(new ie("mapview-arcade",`Unable to handle geometryType: ${t}`)),s=>s}}const it=t=>{if(!t)return[0,0,0,0];const{r:e,g:s,b:r,a:n}=t;return[e,s,r,255*n]};let ue=class d{static findApplicableOverrides(e,s,r){if(e&&s){if(e.primitiveName){let n=!1;for(const o of r)if(o.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const o of s)o.primitiveName===e.primitiveName&&r.push(o)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)d.findApplicableOverrides(n,s,r);if(e.symbolLayers)for(const n of e.symbolLayers)d.findApplicableOverrides(n,s,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)d.findApplicableOverrides(n,s,r);if(e.markerPlacement&&d.findApplicableOverrides(e.markerPlacement,s,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const n of e.markerGraphics)d.findApplicableOverrides(n,s,r),d.findApplicableOverrides(n.symbol,s,r)}else e.type==="CIMCharacterMarker"?d.findApplicableOverrides(e.symbol,s,r):e.type==="CIMHatchFill"?d.findApplicableOverrides(e.lineSymbol,s,r):e.type==="CIMPictureMarker"&&d.findApplicableOverrides(e.animatedSymbolProperties,s,r)}}}static findEffectOverrides(e,s){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&Fe(e),!s||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=te(e),n=e.primitiveName,o=[];for(const a of s)a.primitiveName===n&&o.push(te(a));return{type:"cim-effect-param",effect:r,overrides:Ae(o)}}static async resolveSymbolOverrides(e,s,r,n,o,a,u){if(!(e!=null&&e.symbol))return null;let{symbol:h,primitiveOverrides:c}=e;const C=!!c;if(!C&&!n)return h;h=f(h),c=f(c);let $=!0;if(s||(s={attributes:{}},$=!1),C){if($||(c=c.filter(m=>{var p;return!((p=m.valueExpressionInfo)!=null&&p.expression.includes("$feature"))})),u||(c=c.filter(m=>{var p;return!((p=m.valueExpressionInfo)!=null&&p.expression.includes("$view"))})),c.length>0){const m={spatialReference:r,fields:qe(s.attributes),geometryType:o};await d.createRenderExpressions(c,m),d.evaluateOverrides(c,s,o??"esriGeometryPoint",a,u)}d.applyOverrides(h,c)}return n&&d.applyDictionaryTextOverrides(h,s,n,null),h}static async createRenderExpressions(e,s){const r=[];for(const n of e){const o=n.valueExpressionInfo;if(!o||d._expressionToRenderExpression.has(o.expression))continue;const a=fe(o.expression,s.spatialReference,s.fields);r.push(a),a.then(u=>d._expressionToRenderExpression.set(o.expression,u))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,s,r,n,o){const a={$view:{scale:o==null?void 0:o.scale}};for(const u of e){u.value&&typeof u.value=="object"&&Le(u.value)&&(u.propertyName==="Color"||u.propertyName==="StrokeColor")&&(u.value=it(u.value));const h=u.valueExpressionInfo;if(!h)continue;const c=d._expressionToRenderExpression.get(h.expression);c&&(u.value=tt(c,s,a,r,n))}}static applyDictionaryTextOverrides(e,s,r,n,o="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const a=e.symbolLayers;if(!a)return;for(const u of a)u&&u.type==="CIMVectorMarker"&&d.applyDictionaryTextOverrides(u,s,r,n,e.type==="CIMTextSymbol"?e.textCase:o)}break;case"CIMVectorMarker":{const a=e.markerGraphics;if(!a)return;for(const u of a)u&&d.applyDictionaryTextOverrides(u,s,r,n)}break;case"CIMMarkerGraphic":{const a=e.textString;if(a&&a.includes("[")){const u=He(a,r);e.textString=ze(s,u,n,o)}}}}static applyOverrides(e,s,r,n){if(e.primitiveName){for(const o of s)if(o.primitiveName===e.primitiveName){const a=Ge(o.propertyName);if(n&&n.push({cim:e,nocapPropertyName:a,value:e[a]}),r){let u=!1;for(const h of r)h.primitiveName===e.primitiveName&&(u=!0);u||r.push(o)}o.value!=null&&(e[a]=o.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const o of e.effects)d.applyOverrides(o,s,r,n);if(e.symbolLayers)for(const o of e.symbolLayers)d.applyOverrides(o,s,r,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const o of e.effects)d.applyOverrides(o,s,r,n);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const o of e.markerGraphics)d.applyOverrides(o,s,r,n),d.applyOverrides(o.symbol,s,r,n)}}static restoreOverrides(e){for(const s of e)s.cim[s.nocapPropertyName]=s.value}static buildOverrideKey(e){let s="";for(const r of e)r.value!==void 0&&(s+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return s}static toValue(e,s){if(e==="DashTemplate")return s.split(" ").map(r=>Number(r));if(e==="Color"){const r=new w(s).toRgba();return r[3]*=255,r}return s}};ue._expressionToRenderExpression=new Map;const se="esri.renderers.support.DictionaryLoader",ot={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let pe=class{constructor(e,s,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new De(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=s,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,s){var $;let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{r=await this._dictionaryPromise}catch(m){if(he(m))return this._dictionaryPromise=null,null}const n=($=this._dictionaryVersion)==null?void 0:$.greaterEqual(4,0),o={};if(this.fieldMap)for(const m of this._symbolFields){const p=Be(this.fieldMap[m],this._fieldIndex);if(p){const y=e.attributes[p];o[m]=n?y:y!=null?""+e.attributes[p]:""}else o[m]=""}let a=null;try{a=r==null?void 0:r(o,s)}catch{return null}if(!a||typeof a!="string"||a==="invalid")return null;const u=a.split(";"),h=[],c=[];for(let m=0;m<u.length;m++){const p=u[m];if(p){if(p.includes("po:")){const y=p.slice(3).split("|");if(y.length===3){const E=y[0],j=y[1];let I=y[2];const H="countrylabel";if(E===H&&j==="TextString"){if(this.fieldMap!=null){let x=this.fieldMap[H];x==null&&(x=H,this.fieldMap[x]=x),e.attributes[x]=I}continue}if(j==="DashTemplate")I=I.split(" ").map(x=>Number(x));else if(j==="Color"){const x=new w(I).toRgba();I=[x[0],x[1],x[2],255*x[3]]}else I=Number(I);c.push({primitiveName:E,propertyName:j,value:I,defaultValue:null})}}else if(p.includes("|")){for(const y of p.split("|"))if(this._itemNames.has(y)){h.push(y);break}}else if(this._itemNames.has(p))h.push(p);else if(m===0){h.length=0;let y="Invalid_P";e.geometry!=null&&(me(e.geometry)?y="Invalid_A":be(e.geometry)&&(y="Invalid_L")),h.push(y);break}}}const C=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,h,c,C,s)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void N.getLogger(se).error("no valid URL!");const s=Y(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([s,ge()]);if(!r)throw this._dictionaryPromise=null,new ie("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:o,expression:a,itemsNames:u}=r,h=a;let c=!1;o&&(this._dictionaryVersion=Te.parse(o),c=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(u),this._symbolFields=n.symbol;const C={};if(this.config){const p=this.config;for(const y in p)C[y]=p[y]}if(n.configuration)for(const p of n.configuration)C.hasOwnProperty(p.name)||(C[p.name]=p.value);const $=[];if(e!=null&&e.fields&&this.fieldMap)for(const p in this.fieldMap){const y=this.fieldMap[p],E=e.fields.filter(j=>j.name.toLowerCase()===(y==null?void 0:y.toLowerCase()));E.length>0&&$.push({...E[0],type:c?E[0].type:"esriFieldTypeString"})}$.length>0&&(this._fieldIndex=new _e($));const m=ve(h,e!=null?e.spatialReference:null,$,C).then(p=>{const y={scale:0};return(E,j)=>{if(p==null)return null;const I=p.repurposeFeature({geometry:null,attributes:E});return y.scale=j!=null?j.scale??void 0:void 0,p.evaluate({$feature:I,$view:y},p.services)}}).catch(p=>(N.getLogger(se).error("Creating dictionary expression failed:",p),null));return this._dictionaryPromise=m,m}async _cimPartsToCIMSymbol(e,s,r,n,o){const a=new Array(s.length);for(let c=0;c<s.length;c++)a[c]=this._getSymbolPart(s[c],o);let u=await Promise.all(a);const h=this.fieldMap;if(h){u=f(u);for(const c of u)ue.applyDictionaryTextOverrides(c,e,h,this._fieldIndex,Ue(c))}return new we({data:nt(u,r,n)})}async _getSymbolPart(e,s){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(a=>a.data);const n=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),o=Y(n,{responseType:"json",query:{f:"json"},...s});this._ongoingRequests.set(e,o),o.finally(()=>this._ongoingRequests.delete(e));try{const a=await o;return this._symbolCache.put(e,a.data),a.data}catch(a){throw a}}};function nt(t,e,s){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.effects=null,r.symbolLayers=[];for(const n of t){const o=n;if(o.effects!=null)for(const a of o.symbolLayers)a.effects==null?a.effects=o.effects:a.effects.unshift(...o.effects);r.symbolLayers.unshift(...o.symbolLayers)}}return s&&(r.callout=ot),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var G;let S=G=class extends q(V){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new pe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,s,r){r!=null&&r.origin||super.writeVisualVariables(t,e,s,r)}clone(){return new G({config:f(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:f(this.fieldMap),url:f(this.url),visualVariables:f(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await F(t,e,this.scaleExpression);for(const s in this.fieldMap){const r=this.fieldMap[s];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,s)=>e+s.getAttributeHash(),""))??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};i([l({type:pe})],S.prototype,"_loader",null),i([l({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],S.prototype,"config",void 0),i([l({type:Object,json:{write:!0}})],S.prototype,"fieldMap",void 0),i([l({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],S.prototype,"scaleExpression",void 0),i([ee("scaleExpression")],S.prototype,"writeData",null),i([l({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],S.prototype,"scaleExpressionTitle",void 0),i([l({type:String,json:{write:!0}})],S.prototype,"url",void 0),i([ee("visualVariables")],S.prototype,"writeVisualVariables",null),S=G=i([M("esri.renderers.DictionaryRenderer")],S);const lt=S;var B;let O=B=class extends T{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(N.getLogger(this).error(".field: field must be a string value"),null):Se(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new B({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};i([l({type:w,json:{type:[Number],write:!0}})],O.prototype,"color",void 0),i([l({type:String,json:{write:!0}})],O.prototype,"field",void 0),i([xe("field")],O.prototype,"castField",null),i([l({type:String,json:{write:!0}})],O.prototype,"label",void 0),i([l({type:String,json:{write:!0}})],O.prototype,"valueExpression",void 0),i([l({type:String,json:{write:!0}})],O.prototype,"valueExpressionTitle",void 0),O=B=i([M("esri.renderers.support.AttributeColorInfo")],O);const ce=O;var U;let _=U=class extends T{constructor(){super(...arguments),this.unit=null}clone(){return new U({unit:this.unit})}};i([l({type:String,json:{write:!0}})],_.prototype,"unit",void 0),_=U=i([M("esri.renderers.support.DotDensityLegendOptions")],_);const at=_;var J;let g=J=class extends q(V){constructor(t){super(t),this.attributes=null,this.backgroundColor=new w([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new X,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new $e({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,s)=>e+s.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new J({attributes:f(this.attributes),backgroundColor:f(this.backgroundColor),dotBlendingEnabled:f(this.dotBlendingEnabled),dotShape:f(this.dotShape),dotSize:f(this.dotSize),dotValue:f(this.dotValue),legendOptions:f(this.legendOptions),outline:f(this.outline),referenceScale:f(this.referenceScale),seed:f(this.seed),visualVariables:f(this.visualVariables),authoringInfo:f(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(s=>s.field||s.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const s of this.attributes??[])s.valueExpression&&await F(t,e,s.valueExpression),s.field&&t.add(s.field)}};i([l({type:[ce],json:{write:!0}})],g.prototype,"attributes",void 0),i([l({type:w,json:{write:!0}})],g.prototype,"backgroundColor",void 0),i([l({type:Boolean,json:{write:!0}})],g.prototype,"dotBlendingEnabled",void 0),i([l({type:String,json:{write:!1}})],g.prototype,"dotShape",void 0),i([l({type:Number,json:{write:!0}})],g.prototype,"dotSize",void 0),i([l({type:at,json:{write:!0}})],g.prototype,"legendOptions",void 0),i([l({type:X,json:{default:null,write:!0}})],g.prototype,"outline",void 0),i([l({type:Number,json:{write:!0}})],g.prototype,"dotValue",void 0),i([l({type:Number,json:{write:!0}})],g.prototype,"referenceScale",void 0),i([l({type:Number,json:{write:!0}})],g.prototype,"seed",void 0),i([A({dotDensity:"dot-density"})],g.prototype,"type",void 0),g=J=i([M("esri.renderers.DotDensityRenderer")],g);const ut=g;var Z;let D=Z=class extends T{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Z({color:this.color&&this.color.clone(),ratio:this.ratio})}};i([l({type:w,json:{type:[Ie],default:null,write:!0}})],D.prototype,"color",void 0),i([l({type:Number,json:{write:!0}})],D.prototype,"ratio",void 0),D=Z=i([M("esri.renderers.support.HeatmapColorStop")],D);const L=D;let k=class extends Q(T){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};i([l({type:String,json:{write:!0}})],k.prototype,"minLabel",void 0),i([l({type:String,json:{write:!0}})],k.prototype,"maxLabel",void 0),i([l({type:String,json:{write:!0}})],k.prototype,"title",void 0),k=i([M("esri.renderers.support.HeatmapLegendOptions")],k);var K;function re(t){if(t!=null){const{maxDensity:e,minDensity:s,radius:r}=t;if(e!=null||s!=null||r!=null){const{blurRadius:n,maxPixelIntensity:o,minPixelIntensity:a,...u}=t;return u}}return t}let b=K=class extends V{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new L({ratio:0,color:new w("rgba(255, 140, 0, 0)")}),new L({ratio:.75,color:new w("rgba(255, 140, 0, 1)")}),new L({ratio:.9,color:new w("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(t){return re(t)}get blurRadius(){return Xe(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,s=this.minPixelIntensity;this._set("radius",Qe(t)),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",s*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(Ye**2*this.blurRadius**4)}read(t,e){t=re(t),super.read(t,e)}getSymbol(){return new oe}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const s=this.field,r=this.valueExpression;s&&typeof s=="string"&&Me(t,e,s),r&&typeof r=="string"&&await F(t,e,r)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new K({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:f(this.colorStops),field:this.field,legendOptions:f(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};i([l({type:Ee,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],b.prototype,"authoringInfo",void 0),i([l({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],b.prototype,"blurRadius",null),i([l({type:[L],json:{write:!0}})],b.prototype,"colorStops",void 0),i([l({type:String,json:{write:!0}})],b.prototype,"field",void 0),i([l({type:k,json:{write:!0}})],b.prototype,"legendOptions",void 0),i([l({type:Number,json:{write:!0}})],b.prototype,"maxDensity",void 0),i([l({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],b.prototype,"maxPixelIntensity",null),i([l({type:Number,json:{write:!0}})],b.prototype,"minDensity",void 0),i([l({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],b.prototype,"minPixelIntensity",null),i([l({type:Number,cast:ne,json:{write:!0}})],b.prototype,"radius",void 0),i([l({type:Number,range:{min:0},json:{default:0,write:!0}})],b.prototype,"referenceScale",void 0),i([A({heatmap:"heatmap"})],b.prototype,"type",void 0),i([l({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],b.prototype,"valueExpression",void 0),i([l({type:String})],b.prototype,"valueExpressionTitle",void 0),i([l({readOnly:!0})],b.prototype,"_pixelIntensityToDensity",null),b=K=i([M("esri.renderers.HeatmapRenderer")],b);const ye=b;let R=class extends Q(T){constructor(){super(...arguments),this.color=new w([0,0,0,0]),this.label=null,this.threshold=0}};i([l({type:w,json:{write:!0}})],R.prototype,"color",void 0),i([l({type:String,json:{write:!0}})],R.prototype,"label",void 0),i([l({type:Number,range:{min:0,max:1},json:{write:!0}})],R.prototype,"threshold",void 0),R=i([M("esri.renderers.support.OthersCategory")],R);const pt={base:Ve,key:"type",typeMap:{size:Re,opacity:Pe}};let v=class extends q(Q(V)){constructor(t){super(t),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new w([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new R,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){var t;return new oe({size:this.size?this.size/2+(((t=this.outline)==null?void 0:t.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(Ce)}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,s)=>e+s.getAttributeHash(),""))??""}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const s of this.attributes)s.valueExpression&&await F(t,e,s.valueExpression),s.field&&t.add(s.field)}};i([l({type:[ce],json:{write:!0}})],v.prototype,"attributes",void 0),i([l(Ne)],v.prototype,"backgroundFillSymbol",void 0),i([l({type:w,json:{write:!0}})],v.prototype,"defaultColor",void 0),i([l({type:String,json:{write:!0}})],v.prototype,"defaultLabel",void 0),i([l({type:Number,range:{min:0,max:1},json:{write:!0}})],v.prototype,"holePercentage",void 0),i([l({type:R,json:{write:!0}})],v.prototype,"othersCategory",void 0),i([l({type:et,json:{write:!0}})],v.prototype,"legendOptions",void 0),i([l({type:X,json:{default:null,write:!0}})],v.prototype,"outline",void 0),i([l({type:Number,cast:ne,json:{write:!0}})],v.prototype,"size",void 0),i([A({pieChart:"pie-chart"})],v.prototype,"type",void 0),i([l({types:[pt]})],v.prototype,"visualVariables",void 0),v=i([M("esri.renderers.PieChartRenderer")],v);const ct=v;var W;let P=W=class extends q(V){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(s=>s.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){var t;return((t=this.visualVariables)==null?void 0:t.reduce((e,s)=>e+s.getAttributeHash(),""))??""}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new W({description:this.description,label:this.label,symbol:f(this.symbol),visualVariables:f(this.visualVariables),authoringInfo:f(this.authoringInfo)})}};i([l({type:String,json:{write:!0}})],P.prototype,"description",void 0),i([l({type:String,json:{write:!0}})],P.prototype,"label",void 0),i([l(ke)],P.prototype,"symbol",void 0),i([A({simple:"simple"})],P.prototype,"type",void 0),P=W=i([M("esri.renderers.SimpleRenderer")],P);const de=P,yt={key:"type",base:V,typeMap:{heatmap:ye,simple:de,"unique-value":ae,"class-breaks":le,"dot-density":ut,dictionary:lt,"pie-chart":ct},errorContext:"renderer"},Nt={key:"type",base:V,typeMap:{simple:de,"unique-value":ae,"class-breaks":le,heatmap:ye},errorContext:"renderer",validate:dt};function dt(t){switch(t.type){case"simple":return ft(t);case"unique-value":return ht(t);case"class-breaks":return mt(t);case"heatmap":return t}}function ft(t){if(t.symbol)return t;N.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function ht(t){const e=t.uniqueValueInfos,s=e==null?void 0:e.filter(({symbol:r,label:n},o)=>(r||N.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${o}] ${n}) without a symbol from web scene.`),!!r));return(s==null?void 0:s.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=s),t}function mt(t){const e=t.classBreakInfos,s=e==null?void 0:e.filter(({symbol:r,label:n},o)=>(r||N.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${o}] ${n}) without a symbol from web scene.`),!!r));return(s==null?void 0:s.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=s),t}function Pt(t,e){return gt(t,null,e)}const bt=je({types:yt});function gt(t,e,s){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(s!=null&&s.messages&&s.messages.push(new Oe("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:s})),null):bt(t,e,s):null}export{yt as m,gt as o,de as p,Pt as t,Nt as u};
