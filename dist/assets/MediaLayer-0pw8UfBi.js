const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mediaLayerUtils-B0wxmkP7.js","assets/utils-paHww2CL.js","assets/index-DMwY2Yeh.js","assets/index-DGW5n9KZ.css","assets/originUtils-D69mHv66.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/PortalItem-CJdFYfTh.js","assets/jsonContext-C78W7VHJ.js","assets/portalItemUtils-Doqe9RdJ.js","assets/projection-DL1aNLQS.js","assets/projectBuffer-CWX1J5rk.js","assets/zscale-DcxcvFoT.js","assets/saveUtils-wtvPKSWy.js","assets/resourceUtils-Dyf7tLtD.js","assets/uuid-Cl5lrJ4c.js","assets/resourceUtils-zXxE_W0H.js"])))=>i.map(i=>d[i]);
import{aG as mt,d$ as De,t as k,X as i,a2 as P,bV as ft,g as Oe,j as f,s as b,fl as R,v as fe,Z as u,a1 as ne,a0 as re,P as yt,w as Se,bZ as gt,fm as Ce,c3 as xt,ca as te,fn as _t,K as qe,p as vt,c1 as je,c5 as Xe,c2 as Pt,c4 as Qe,dk as Le,c6 as Ee,fo as wt,U as Ze,ah as $t,cQ as Rt,cy as bt,bQ as It,A as Ot,D as St,cW as Lt,B as Et,C as Ye,fp as Mt,aO as Tt,fq as Ct,b5 as jt,e6 as Re,bx as Vt,fr as Nt,e2 as Ve,fs as At,eb as Ht,aL as Wt,b6 as zt,V as me,a4 as Gt,dp as Ut,aj as kt,ft as Bt,cI as Jt,_ as Ft,cn as Kt}from"./index-DMwY2Yeh.js";import{S as et,f as Dt}from"./Layer-B7MPCWr8.js";import{l as qt}from"./BlendLayer-BZi4HZ3X.js";import{b as Xt}from"./OperationalLayer-DkH5aW2U.js";import{j as Qt}from"./PortalLayer-DdSdd8Dt.js";import{t as Zt}from"./ScaleRangeLayer-BawLb3lW.js";import{u as tt,i as nt,c as ot,r as Ne,s as Yt}from"./mat3-BBgb1kkc.js";import{e as B,t as en}from"./mat3f64-q3fE-ZOt.js";import{o as L,_ as Ae,I as D}from"./vec2-DeTgPWAI.js";import{o as st,N as rt}from"./vec32-wPxsRdwz.js";import{n as O,r as ue}from"./vec2f64-DA6GkJuH.js";import{V as q,N as tn,K as nn}from"./projection-DL1aNLQS.js";import{p as on}from"./imageUtils-CepuWy0-.js";import{n as sn}from"./uuid-Cl5lrJ4c.js";import{u as rn}from"./common-DokbeE9L.js";import{p as ln}from"./resourceExtension-B3cY2odO.js";import{o as an}from"./BoundsStore-BlsL-ylb.js";import{r as He,s as un,i as Z}from"./normalizeUtilsCommon-Dh7MTQbs.js";import{A as ce}from"./interfaces-CL2NbQte.js";import"./TimeExtent-D_QVyVxF.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-DsYZliz4.js";import"./commonProperties-BfyFIYkl.js";import"./ElevationInfo-BPUkZdoe.js";import"./lengthUtils-DPy0fDMV.js";import"./layerUtils-Co4QOtAn.js";import"./PortalItem-CJdFYfTh.js";import"./portalItemUtils-Doqe9RdJ.js";import"./projectBuffer-CWX1J5rk.js";import"./zscale-DcxcvFoT.js";import"./PooledRBush-B0deq4V0.js";import"./quickselect-QQC62dOK.js";const v=mt(),J=B(),Pe=B(),We=B();function E(e,t,n){return st(v,t[0],t[1],1),rt(v,v,tt(J,n)),v[2]===0?L(e,v[0],v[1]):L(e,v[0]/v[2],v[1]/v[2])}function it(e,t,n){return ze(Pe,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),ze(We,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),nt(e,ot(Pe,Pe),We),e[8]!==0&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function ze(e,t,n,o,s,r,l,a,c){Ne(e,t,o,r,n,s,l,1,1,1),st(v,a,c,1),ot(J,e);const[p,h,d]=rt(v,v,tt(J,J));return Ne(J,p,0,0,0,h,0,0,0,d),nt(e,J,e)}let be=class extends De{projectOrWarn(e,t){if(e==null)return e;const{geometry:n,pending:o}=q(e,t);return o?null:o||n?n:(k.getLogger(this).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:t}),null)}};be=i([P("esri.layers.support.GeoreferenceBase")],be);const oe=be,we=B(),m=O();let Y=class extends yt{};i([u({type:Number,json:{write:!0}})],Y.prototype,"x",void 0),i([u({type:Number,json:{write:!0}})],Y.prototype,"y",void 0),Y=i([P("esri.layers.support.ControlPointsGeoreference.ControlPointJSONType")],Y);let ee=class extends De{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};i([u()],ee.prototype,"sourcePoint",void 0),i([u({type:f})],ee.prototype,"mapPoint",void 0),ee=i([P("esri.layers.support.ControlPointsGeoreference.ControlPoint")],ee);let w=class extends ft(oe){constructor(t){super(t),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(t,n){const o=Oe.fromJSON(n.spatialReference),s=en(...n.coefficients,1);return t.map(r=>(L(m,r.x,r.y),E(m,m,s),{sourcePoint:r,mapPoint:new f({x:m[0],y:m[1],spatialReference:o})}))}writeControlPoints(t,n,o,s){if(this.transform!=null)t!=null&&_(t[0])&&(n.controlPoints=t.map(r=>{const l=r.sourcePoint;return{x:l.x,y:l.y}}),n.spatialReference=t[0].mapPoint.spatialReference.toJSON(),n.coefficients=this.transform.slice(0,8));else{const r=new b("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration. Make sure the parent media element is loaded i.e. the ImageElement or VideoElement set as 'MediaLayer.source'.",{layer:s==null?void 0:s.layer,georeference:this});s!=null&&s.messages?s.messages.push(r):k.getLogger(this).error(r.name,r.message)}}get coords(){if(this.controlPoints==null)return null;const t=this._updateTransform(we);if(t==null||!_(this.controlPoints[0]))return null;const n=this.controlPoints[0].mapPoint.spatialReference;return mn(t,this.width,this.height,n)}set coords(t){if(this.controlPoints==null||!_(this.controlPoints[0]))return;const n=this.controlPoints[0].mapPoint.spatialReference;if((t=this.projectOrWarn(t,n))==null)return;const{width:o,height:s}=this,{rings:[[r,l,a,c]]}=t,p={sourcePoint:R(0,s),mapPoint:new f({x:r[0],y:r[1],spatialReference:n})},h={sourcePoint:R(0,0),mapPoint:new f({x:l[0],y:l[1],spatialReference:n})},d={sourcePoint:R(o,0),mapPoint:new f({x:a[0],y:a[1],spatialReference:n})},y={sourcePoint:R(o,s),mapPoint:new f({x:c[0],y:c[1],spatialReference:n})};_(p)&&_(h)&&_(d)&&_(y)&&(Ge(we,p,h,d,y),this.controlPoints=this.controlPoints.map(({sourcePoint:x})=>(L(m,x.x,x.y),E(m,m,we),{sourcePoint:x,mapPoint:new f({x:m[0],y:m[1],spatialReference:n})})))}get inverseTransform(){return this.transform==null?null:Yt(B(),this.transform)}get transform(){return this._updateTransform()}toMap(t){if(t==null||this.transform==null||this.controlPoints==null||!_(this.controlPoints[0]))return null;L(m,t.x,t.y);const n=this.controlPoints[0].mapPoint.spatialReference;return E(m,m,this.transform),new f({x:m[0],y:m[1],spatialReference:n})}toSource(t){if(t==null||this.inverseTransform==null||this.controlPoints==null||!_(this.controlPoints[0]))return null;const n=this.controlPoints[0].mapPoint.spatialReference;return t=t.normalize(),(t=q(t,n).geometry)==null?null:(L(m,t.x,t.y),E(m,m,this.inverseTransform),R(m[0],m[1]))}toSourceNormalized(t){const n=this.toSource(t);return n!=null&&(n.x/=this.width,n.y/=this.height),n}_updateTransform(t){const{controlPoints:n,width:o,height:s}=this;if(!(n!=null&&o>0&&s>0))return null;const[r,l,a,c]=n;if(!_(r))return null;const p=r.mapPoint.spatialReference,h=this._projectControlPoint(l,p),d=this._projectControlPoint(a,p),y=this._projectControlPoint(c,p);if(!h.valid||!d.valid||!y.valid||!_(h.controlPoint))return null;t==null&&(t=B());let x=null;return x=_(d.controlPoint)&&_(y.controlPoint)?Ge(t,r,h.controlPoint,d.controlPoint,y.controlPoint):_(d.controlPoint)?pn(t,r,h.controlPoint,d.controlPoint):cn(t,r,h.controlPoint),x.every(ye=>ye===0)?null:x}_projectControlPoint(t,n){if(!_(t))return{valid:!0,controlPoint:t};const{sourcePoint:o,mapPoint:s}=t,{geometry:r,pending:l}=q(s,n);return l?{valid:!1,controlPoint:null}:l||r?{valid:!0,controlPoint:{sourcePoint:o,mapPoint:r}}:(k.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:t,sourceSpatialReference:s.spatialReference,targetSpatialReference:n}),{valid:!1,controlPoint:null})}};function _(e){return(e==null?void 0:e.sourcePoint)!=null&&e.mapPoint!=null}i([u({type:[ee],json:{write:{allowNull:!1,isRequired:!0,target:{controlPoints:{type:[Y]},coefficients:{type:[Number]},spatialReference:{type:Oe}}}}})],w.prototype,"controlPoints",void 0),i([ne("controlPoints")],w.prototype,"readControlPoints",null),i([re("controlPoints")],w.prototype,"writeControlPoints",null),i([u({clonable:!1})],w.prototype,"coords",null),i([u({type:Number,nonNullable:!0,json:{write:!0}})],w.prototype,"height",void 0),i([u({readOnly:!0})],w.prototype,"inverseTransform",null),i([u({readOnly:!0})],w.prototype,"transform",null),i([u({type:Number,nonNullable:!0,json:{write:!0}})],w.prototype,"width",void 0),w=i([P("esri.layers.support.ControlPointsGeoreference")],w);const M=O(),T=O(),G=O(),A=O(),C=O(),j=O(),U=O(),H=O(),pe=Math.PI/2;function V(e,t,n){L(e,n.sourcePoint.x,n.sourcePoint.y),L(t,n.mapPoint.x,n.mapPoint.y)}function cn(e,t,n){return V(M,C,t),V(T,j,n),D(G,T,M,pe),D(A,M,T,pe),D(U,j,C,-pe),D(H,C,j,-pe),Me(e,M,T,G,A,C,j,U,H)}function pn(e,t,n,o){return V(M,C,t),V(T,j,n),V(G,U,o),Ae(A,M,T,.5),D(A,G,A,Math.PI),Ae(H,C,j,.5),D(H,U,H,Math.PI),Me(e,M,T,G,A,C,j,U,H)}function Ge(e,t,n,o,s){return V(M,C,t),V(T,j,n),V(G,U,o),V(A,H,s),Me(e,M,T,G,A,C,j,U,H)}const hn=new Array(8).fill(0),dn=new Array(8).fill(0);function Ue(e,t,n,o,s){return e[0]=t[0],e[1]=t[1],e[2]=n[0],e[3]=n[1],e[4]=o[0],e[5]=o[1],e[6]=s[0],e[7]=s[1],e}function Me(e,t,n,o,s,r,l,a,c){return it(e,Ue(hn,t,n,o,s),Ue(dn,r,l,a,c))}function mn(e,t,n,o){const s=ue(0,n),r=ue(0,0),l=ue(t,0),a=ue(t,n);return E(s,s,e),E(r,r,e),E(l,l,e),E(a,a,e),new fe({rings:[[s,r,l,a,s]],spatialReference:o})}const se=w,X=O();let N=class extends oe{constructor(t){super(t),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:t,topRight:n,bottomLeft:o,bottomRight:s}=this;if(t==null||n==null||o==null||s==null)return null;const r=t.spatialReference;return n=this.projectOrWarn(n,r),o=this.projectOrWarn(o,r),s=this.projectOrWarn(s,r),n==null||o==null||s==null?null:new fe({rings:[[[o.x,o.y],[t.x,t.y],[n.x,n.y],[s.x,s.y],[o.x,o.y]]],spatialReference:r})}set coords(t){const{topLeft:n}=this;if(n==null)return;const o=n.spatialReference;if((t=this.projectOrWarn(t,o))==null)return;const{rings:[[s,r,l,a]]}=t;this.bottomLeft=new f({x:s[0],y:s[1],spatialReference:o}),this.topLeft=new f({x:r[0],y:r[1],spatialReference:o}),this.topRight=new f({x:l[0],y:l[1],spatialReference:o}),this.bottomRight=new f({x:a[0],y:a[1],spatialReference:o})}toSourceNormalized(t){const{topLeft:n,topRight:o,bottomRight:s,bottomLeft:r}=this;if(t==null||n==null||o==null||s==null||r==null)return null;const l=n.spatialReference;t=t.normalize();const a=q(t,l).geometry;if(a==null)return null;L(X,a.x,a.y);const c=it(B(),[n.x,n.y,r.x,r.y,o.x,o.y,s.x,s.y],[0,0,0,1,1,0,1,1]);return E(X,X,c),R(X[0],X[1])}};i([u({clonable:!1})],N.prototype,"coords",null),i([u({type:f})],N.prototype,"bottomLeft",void 0),i([u({type:f})],N.prototype,"bottomRight",void 0),i([u({type:f})],N.prototype,"topLeft",void 0),i([u({type:f})],N.prototype,"topRight",void 0),N=i([P("esri.layers.support.CornersGeoreference")],N);const fn=N;let F=class extends oe{constructor(t){super(t),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(this.extent==null)return null;const{xmin:t,ymin:n,xmax:o,ymax:s,spatialReference:r}=this.extent;let l;if(this.rotation){const{x:a,y:c}=this.extent.center,p=$e(a,c,this.rotation);l=[p(t,n),p(t,s),p(o,s),p(o,n)],l.push(l[0])}else l=[[t,n],[t,s],[o,s],[o,n],[t,n]];return new fe({rings:[l],spatialReference:r})}set coords(t){if(t==null||this.extent==null)return;const n=this.extent.spatialReference;if(t=this.projectOrWarn(t,n),(t==null?void 0:t.extent)==null)return;const{rings:[[o,s,r]],extent:{center:{x:l,y:a}}}=t,c=gt(Math.PI/2-Math.atan2(s[1]-o[1],s[0]-o[0])),p=$e(l,a,-c),[h,d]=p(o[0],o[1]),[y,x]=p(r[0],r[1]);this.extent=new Se({xmin:h,ymin:d,xmax:y,ymax:x,spatialReference:n}),this.rotation=c}toSourceNormalized(t){const{extent:n,rotation:o}=this;if(t==null||n==null)return null;const{xmin:s,ymin:r,xmax:l,ymax:a,center:c,spatialReference:p}=n;t=t.normalize();const h=q(t,p).geometry;if(h==null)return null;let d=h.x,y=h.y;return o&&([d,y]=$e(c.x,c.y,-o)(d,y)),R(Ce(d,s,l,0,1),Ce(y,a,r,0,1))}};function $e(e,t,n){const o=rn(n),s=Math.cos(o),r=Math.sin(o);return(l,a)=>[s*(l-e)+r*(a-t)+e,s*(a-t)-r*(l-e)+t]}i([u({clonable:!1})],F.prototype,"coords",null),i([u({type:Se})],F.prototype,"extent",void 0),i([u({type:Number})],F.prototype,"rotation",void 0),F=i([P("esri.layers.support.ExtentAndRotationGeoreference")],F);const yn=F;function gn(e){return(e==null?void 0:e.type)==="media"}function lt(e,t){const n=xt(t);return gn(e)&&!!e.portalItem&&n!=null&&n>te.PORTAL_ITEM}function xn(e,t,n){var p;if(!e||e.type==="control-points")return e;const{coords:o}=e;if(((p=o==null?void 0:o.rings[0])==null?void 0:p.length)!==5)return null;const[s,r,l,a]=o.rings[0],{spatialReference:c}=o;return new se({controlPoints:[{mapPoint:new f({x:s[0],y:s[1],spatialReference:c}),sourcePoint:R(0,n)},{mapPoint:new f({x:r[0],y:r[1],spatialReference:c}),sourcePoint:R(0,0)},{mapPoint:new f({x:l[0],y:l[1],spatialReference:c}),sourcePoint:R(t,0)},{mapPoint:new f({x:a[0],y:a[1],spatialReference:c}),sourcePoint:R(t,n)}],width:t,height:n})}function at(e,t,n){return{enabled:!lt(n==null?void 0:n.layer,n==null?void 0:n.origin),ignoreOrigin:!0}}const ut={json:{name:"url",type:String,write:{overridePolicy:at}}},ct={readOnly:!0,json:{read:!1,write:{target:"mediaType",overridePolicy:at}}},_n={types:{key:"type",base:oe,typeMap:{"control-points":se,corners:fn,"extent-and-rotation":yn}},json:{types:{key:"type",base:oe,typeMap:{"control-points":se}},write:{overridePolicy:()=>({enabled:!0,ignoreOrigin:!0})}}};let z=class extends _t(et(qe)){constructor(e){super(e),this.georeference=null,this.opacity=1}readGeoreference(e){return se.fromJSON(e)}writeGeoreference(e,t,n,o){var l;const s=(l=o==null?void 0:o.resources)==null?void 0:l.pendingOperations,r=()=>{var c;const a=xn(this.georeference,this.contentWidth,this.contentHeight);if(a){if(e.type!=="control-points"&&k.getLogger(this).warn(`only georeference of type 'control-points' may be persisted. The georeference of type '${e.type}' has been automatically converted.`),((c=a.controlPoints)==null?void 0:c.length)!==4&&(o==null?void 0:o.messages))return void o.messages.push(new b("property:unsupported","only 'control-points' georeference with 4 control points may be persisted."));t[n]=a.write({},o)}};if(e.type!=="control-points"&&!this.loaded&&s)return t[n]={},void s.push(this.load().then(r));r()}get contentWidth(){return 0}get contentHeight(){return 0}toSource(e){const{georeference:t,contentWidth:n,contentHeight:o}=this;if(e==null||t==null||n===0||o===0)return null;const s=t.toSourceNormalized(e);return s==null?null:(s.x*=n,s.y*=o,s)}};i([u(_n)],z.prototype,"georeference",void 0),i([ne("georeference")],z.prototype,"readGeoreference",null),i([re("georeference")],z.prototype,"writeGeoreference",null),i([u({json:{read:!1,write:!1}})],z.prototype,"opacity",void 0),z=i([P("esri.layers.support.MediaElementBase")],z);const Te=z;let $=class extends Te{constructor(t){super(t),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this.image=null}load(){const t=this.image;if(typeof t=="string"){const n=on(t).then(o=>{this._set("content",o)});this.addResolvingPromise(n)}else if(t instanceof HTMLImageElement){const n=t.decode().then(()=>{this._set("content",t)});this.addResolvingPromise(n)}else t?this._set("content",t):this.addResolvingPromise(Promise.reject(new b("image-element:invalid-image-type","Invalid image type",{image:t})));return Promise.resolve(this)}get contentWidth(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return this.content==null?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(t,n,o){return vt(n.url,o)}writeImage(t,n,o,s){if(t==null)return;const r=s==null?void 0:s.portalItem,l=s==null?void 0:s.resources;if(!r||!l)return void(typeof t=="string"&&(n[o]=je(t,s)));const a=vn(t)?t:null;if(a){if(Xe(a)==null)return void(n[o]=a);const c=je(a,{...s,verifyItemRelativeUrls:s!=null&&s.verifyItemRelativeUrls?{writtenUrls:s.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},Pt.NO);if(r&&c&&!Qe(c))return l.toKeep.push({resource:r.resourceFromPath(c),compress:!1}),void(n[o]=c)}n[o]="<pending>",l.pendingOperations.push(Pn(t).then(c=>{const p=$n(c,r);n[o]=p.itemRelativeUrl,l.toAdd.push({resource:p,content:{type:"blob",blob:c},compress:!1,finish:h=>{this.image=h.url}})}))}};i([u()],$.prototype,"animationOptions",void 0),i([u({readOnly:!0})],$.prototype,"content",void 0),i([u({readOnly:!0})],$.prototype,"contentWidth",null),i([u({readOnly:!0})],$.prototype,"contentHeight",null),i([u(ut)],$.prototype,"image",void 0),i([ne("image",["url"])],$.prototype,"readImage",null),i([re("image")],$.prototype,"writeImage",null),i([u(ct)],$.prototype,"type",void 0),$=i([P("esri.layers.support.ImageElement")],$);const pt=$;function vn(e){return typeof e=="string"&&!Le(e)&&!Ee(e)}async function Pn(e){return typeof e=="string"?Le(e)?wt(e):(await Ze(e,{responseType:"blob"})).data:new Promise(t=>wn(e).toBlob(t))}function wn(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,o=document.createElement("canvas"),s=o.getContext("2d");return o.width=t,o.height=n,e instanceof HTMLImageElement?s.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&s.putImageData(e,0,0),o}function $n(e,t){const n=sn(),o=`${$t("media",n)}.${ln({type:"blob",blob:e})}`;return t.resourceFromPath(o)}function Rn(e){return bn(e,!0)}function bn(e,t){if(e==null)return null;const n=e.spatialReference,o=Rt(n),s=bt(e)?e.toJSON():e;if(!o)return s;const r=It(n)?102100:4326,l=He[r].maxX,a=He[r].minX;if(Ot(s))return ke(s,l,a);if(St(s))return s.points=s.points.map(c=>ke(c,l,a)),s;if(Lt(s))return In(s,o);if(Et(s)||Ye(s)){const c=Mt(Sn,s),p={xmin:c[0],ymin:c[1],xmax:c[2],ymax:c[3]},h=Z(p.xmin,a)*(2*l),d=h===0?s:un(s,h);return p.xmin+=h,p.xmax+=h,p.xmax>l?Je(d,l,t):p.xmin<a?Je(d,a,t):d}return s}function In(e,t){if(!t)return e;const n=On(e,t).map(o=>o.extent);return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map(o=>[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]])}}function ke(e,t,n){if(Array.isArray(e)){const o=e[0];if(o>t){const s=Z(o,t);e[0]=o+s*(-2*t)}else if(o<n){const s=Z(o,n);e[0]=o+s*(-2*n)}}else{const o=e.x;if(o>t){const s=Z(o,t);e.x+=s*(-2*t)}else if(o<n){const s=Z(o,n);e.x+=s*(-2*n)}}return e}function On(e,t){const n=[],{ymin:o,ymax:s,xmin:r,xmax:l}=e,a=e.xmax-e.xmin,[c,p]=t.valid,{x:h,frameId:d}=Be(e.xmin,t),{x:y,frameId:x}=Be(e.xmax,t),ye=h===y&&a>0;if(a>2*p){const ge={xmin:r<l?h:y,ymin:o,xmax:p,ymax:s},xe={xmin:c,ymin:o,xmax:r<l?y:h,ymax:s},_e={xmin:0,ymin:o,xmax:p,ymax:s},ve={xmin:c,ymin:o,xmax:0,ymax:s},ie=[],le=[];he(ge,_e)&&ie.push(d),he(ge,ve)&&le.push(d),he(xe,_e)&&ie.push(x),he(xe,ve)&&le.push(x);for(let ae=d+1;ae<x;ae++)ie.push(ae),le.push(ae);n.push(new W(ge,[d]),new W(xe,[x]),new W(_e,ie),new W(ve,le))}else h>y||ye?n.push(new W({xmin:h,ymin:o,xmax:p,ymax:s},[d]),new W({xmin:c,ymin:o,xmax:y,ymax:s},[x])):n.push(new W({xmin:h,ymin:o,xmax:y,ymax:s},[d]));return n}function Be(e,t){const[n,o]=t.valid,s=2*o;let r,l=0;return e>o?(r=Math.ceil(Math.abs(e-o)/s),e-=r*s,l=r):e<n&&(r=Math.ceil(Math.abs(e-n)/s),e+=r*s,l=-r),{x:e,frameId:l}}function he(e,t){const{xmin:n,ymin:o,xmax:s,ymax:r}=t;return de(e,n,o)&&de(e,n,r)&&de(e,s,r)&&de(e,s,o)}function de(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}function Je(e,t,n=!0){const o=!Ye(e);if(o&&Ct(e),n)return new Ln().cut(e,t);const s=o?e.rings:e.paths,r=o?4:2,l=s.length,a=-2*t;for(let c=0;c<l;c++){const p=s[c];if(p&&p.length>=r){const h=[];for(const d of p)h.push([d[0]+a,d[1]]);s.push(h)}}return o?e.rings=s:e.paths=s,e}class W{constructor(t,n){this.extent=t,this.frameIds=n}}const Sn=Tt();class Ln{constructor(){this._linesIn=[],this._linesOut=[]}cut(t,n){let o;if(this._xCut=n,t.rings)this._closed=!0,o=t.rings,this._minPts=4;else{if(!t.paths)return null;this._closed=!1,o=t.paths,this._minPts=2}for(const r of o){if(!r||r.length<this._minPts)continue;let l=!0;for(const a of r)l?(this.moveTo(a),l=!1):this.lineTo(a);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),o=[];for(const r of this._linesIn)r&&r.length>=this._minPts&&o.push(r);const s=-2*this._xCut;for(const r of this._linesOut)if(r&&r.length>=this._minPts){for(const l of r)l[0]+=s;o.push(r)}return this._closed?t.rings=o:t.paths=o,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const n=this._side(t[0]);if(n*this._prevSide==-1){const o=this._intersect(this._prevPt,t);this._lineTo(this._xCut,o,0),this._prevSide=0,this._lineTo(t[0],t[1],n)}else this._lineTo(t[0],t[1],n);this._prevSide=n,this._prevPt=t}close(){const t=this._firstPt,n=this._prevPt;t[0]===n[0]&&t[1]===n[1]||this.lineTo(t),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(t,n,o){this._closed?(this._lineIn.push([o<=0?t:this._xCut,n]),this._lineOut.push([o>=0?t:this._xCut,n])):(o<=0&&this._lineIn.push([t,n]),o>=0&&this._lineOut.push([t,n]))}_lineTo(t,n,o){this._closed?(Fe(this._lineIn,o<=0?t:this._xCut,n),Fe(this._lineOut,o>=0?t:this._xCut,n)):o<0?(this._prevSide===0&&this._pushLineOut(),this._lineIn.push([t,n])):o>0?(this._prevSide===0&&this._pushLineIn(),this._lineOut.push([t,n])):this._prevSide<0?(this._lineIn.push([t,n]),this._lineOut.push([t,n])):this._prevSide>0&&(this._lineOut.push([t,n]),this._lineIn.push([t,n]))}_checkClosingPt(t){const n=t.length;n>3&&t[0][0]===this._xCut&&t[n-2][0]===this._xCut&&t[1][0]===this._xCut&&(t[0][1]=t[n-2][1],t.pop())}_side(t){return t<this._xCut?-1:t>this._xCut?1:0}_intersect(t,n){const o=(this._xCut-t[0])/(n[0]-t[0]);return t[1]+o*(n[1]-t[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function Fe(e,t,n){const o=e.length;o>1&&e[o-1][0]===t&&e[o-2][0]===t?e[o-1][1]=n:e.push([t,n])}let S=class extends jt{constructor(e){super(e)}get bounds(){const e=this.coords;return(e==null?void 0:e.extent)==null?null:Re(e.extent)}get coords(){var t;const e=(t=this.element.georeference)==null?void 0:t.coords;return q(e,this.spatialReference).geometry}get normalizedCoords(){return fe.fromJSON(Rn(this.coords))}get normalizedBounds(){const e=this.normalizedCoords!=null?this.normalizedCoords.extent:null;return e!=null?Re(e):null}};i([u()],S.prototype,"spatialReference",void 0),i([u()],S.prototype,"element",void 0),i([u()],S.prototype,"bounds",null),i([u()],S.prototype,"coords",null),i([u()],S.prototype,"normalizedCoords",null),i([u()],S.prototype,"normalizedBounds",null),S=i([P("esri.layers.support.MediaElementView")],S);let I=class extends Te{constructor(e){super(e),this.autoplay=!0,this.content=null,this.type="video"}load(){const e=this.video;return typeof e=="string"?this.addResolvingPromise(this._preProcessVideoUrl(e).then(t=>{const n=document.createElement("video");return n.src=t,n.crossOrigin="anonymous",n.autoplay=!0,n.muted=!0,n.loop=!0,n.playsInline=!0,this._loadVideo(n).then(()=>{this._set("content",n)})})):e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new b("video-element:invalid-video-type","Invalid video type",{video:e}))),Promise.resolve(this)}get contentWidth(){var e;return((e=this.content)==null?void 0:e.videoWidth)??0}get contentHeight(){var e;return((e=this.content)==null?void 0:e.videoHeight)??0}set video(e){this.loadStatus==="not-loaded"?this._set("video",e):k.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}writeVideo(e,t,n,o){if(!e)return void((o==null?void 0:o.messages)&&o.messages.push(new b("video-element:unsupported-video","video source is missing")));const s=En(e)?e:null;if(!s)return void((o==null?void 0:o.messages)&&o.messages.push(new b("video-element:unsupported-video","video source must be an absolute url")));!Qe(s)&&(o!=null&&o.blockedRelativeUrls)&&o.blockedRelativeUrls.push(s);const r=Vt(s);Xe(r)?o!=null&&o.messages&&o.messages.push(new b("video-element:unsupported-video","video source cannot be an item resource")):t[n]=r}async _preProcessVideoUrl(e){if(Nt(e))return Ve(e);try{return await Ze(e,{method:"head"}),e}catch{return Ve(e,!0)}}_loadVideo(e){return new Promise((t,n)=>{const o=At(e,"canplay",()=>{this.removeHandles("canplay"),this.autoplay?e.play().then(t,n):t()});this.addHandles(o,"canplay"),e.crossOrigin!=="anonymous"&&(e.crossOrigin="anonymous",Ee(e.src)||(e.src=e.src))})}};i([u()],I.prototype,"autoplay",void 0),i([u({readOnly:!0})],I.prototype,"content",void 0),i([u({readOnly:!0})],I.prototype,"contentWidth",null),i([u({readOnly:!0})],I.prototype,"contentHeight",null),i([u(ut)],I.prototype,"video",null),i([re("video")],I.prototype,"writeVideo",null),i([u(ct)],I.prototype,"type",void 0),I=i([P("esri.layers.support.VideoElement")],I);const ht=I;function En(e){return typeof e=="string"&&!Le(e)&&!Ee(e)}const Mn={key:"type",defaultKeyValue:"image",base:Te,typeMap:{image:pt,video:ht}},Ke=me.ofType(Mn);let K=class extends qe.LoadableMixin(Ht(Wt.EventedAccessor)){constructor(e){super(e),this._index=new an,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=t=>{for(const o of t.removed){const s=this._elementViewsMap.get(o);this._elementViewsMap.delete(o),this._index.delete(s),this.removeHandles(s),s.destroy(),this.notifyChange("fullExtent")}const{spatialReference:n}=this;for(const o of t.added){if(this._elementViewsMap.get(o))continue;const s=new S({spatialReference:n,element:o});this._elementViewsMap.set(o,s);const r=zt(()=>s.coords,()=>this._updateIndexForElement(s,!1));this._updateIndexForElement(s,!0),this.addHandles(r,s)}this._elementsIndexes.clear(),this.elements.forEach((o,s)=>this._elementsIndexes.set(o,s)),this.emit("refresh")},this.elements=new Ke}async load(e){if(Gt(e),!this.spatialReference){const t=this.elements.find(n=>{var o;return((o=n.georeference)==null?void 0:o.coords)!=null});this._set("spatialReference",t?t.georeference.coords.spatialReference:Oe.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",Ut(e,this._get("elements"),Ke))}get fullExtent(){if(this.loadStatus==="not-loaded")return null;const e=this._index.fullBounds;return e==null?null:new Se({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){this.loadStatus==="not-loaded"?this._set("spatialReference",e):k.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,t){await this.load(),await tn(e.spatialReference,this.spatialReference,null,t);const n=kt(e.spatialReference,this.spatialReference)?e:nn(e,this.spatialReference);if(!n)return[];const o=n.normalize(),s=[];for(const r of o)this._index.forEachInBounds(Re(r),({normalizedCoords:l,element:a})=>{l!=null&&Bt(r,l)&&s.push(a)});return s.sort((r,l)=>this._elementsIndexes.get(r)-this._elementsIndexes.get(l)),s}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,t){const n=e.normalizedBounds,o=this._index.has(e),s=n!=null;this._index.delete(e),s&&this._index.set(e,n),this.notifyChange("fullExtent"),t||(o!==s?this.emit("refresh"):this.emit("change",{element:e.element}))}};i([u()],K.prototype,"elements",null),i([u({readOnly:!0})],K.prototype,"fullExtent",null),i([u()],K.prototype,"spatialReference",null),K=i([P("esri.layers.support.LocalMediaElementSource")],K);const Q=K;function Ie(e){return typeof e=="object"&&e!=null&&"type"in e}function dt(e){return Ie(e)&&(e.type==="image"||e.type==="video")}let g=class extends qt(Zt(Xt(Qt(et(Dt))))){constructor(e){super(e),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=Jt(async(t,n,o)=>{const{save:s,saveAs:r}=await Ft(()=>import("./mediaLayerUtils-B0wxmkP7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]));switch(t){case ce.SAVE:return s(this,n);case ce.SAVE_AS:return r(this,o,n)}}),this.source=new Q}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){await this.loadFromPortal({supportedTypes:["Media Layer"]},e);let t=this.source;if(!t)throw new b("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const n=this._getSourceOverride(t,this.georeference);n&&(this.setAtOrigin("source",n,"web-map"),this.setAtOrigin("source",n,"web-scene"),t=n);const o=Ie(t)?new Q({elements:new me([t])}):t;this._set("effectiveSource",o),this.spatialReference&&(o.spatialReference=this.spatialReference),await o.load(e),this.spatialReference=o.spatialReference}destroy(){var e,t;(e=this.effectiveSource)==null||e.destroy(),this.effectiveSource!==this.source&&((t=this.source)==null||t.destroy())}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){this.loadStatus!=="loaded"&&this.loadStatus!=="failed"?this._set("source",e):k.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new Q({elements:new me(e)}):e instanceof me?new Q({elements:e}):e:null}readSource(e,t,n){if("itemId"in t&&t.itemId)return;const o=this._createSource(t);return o==null||o.read(t,n),o}writeSource(e,t,n,o){if(e&&e instanceof Q){const s=e.elements.length;if(s!==1)return void((o==null?void 0:o.messages)&&o.messages.push(new b("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${s}.`)));e=e.elements.at(0)}dt(e)?e.write(t,o):o!=null&&o.messages&&(e?o.messages.push(new b("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):o.messages.push(new b("media-layer:unsupported-source","the media layer is missing a source")))}async save(e){return this._debouncedSaveOperations(ce.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(ce.SAVE_AS,t,e)}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new pt;case"video":return new ht}return null}_getSourceOverride(e,t){if(Ie(e)&&this.originIdOf("source")===te.PORTAL_ITEM&&t&&(this.originIdOf("georeference")===te.WEB_MAP||this.originIdOf("georeference")===te.WEB_SCENE)){const n=e.toJSON(),o=this._createSource(n);return o.read({...n},{origin:"portal-item"}),o.read({georeference:t},{origin:"web-map"}),o.read({georeference:t},{origin:"web-scene"}),o}return null}};i([u({readOnly:!0})],g.prototype,"effectiveSource",void 0),i([u({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],g.prototype,"georeference",void 0),i([ne("web-document","georeference")],g.prototype,"readGeoreference",null),i([u({type:String})],g.prototype,"copyright",void 0),i([u({readOnly:!0})],g.prototype,"fullExtent",null),i([u({type:["MediaLayer"]})],g.prototype,"operationalLayerType",void 0),i([u({type:["show","hide"]})],g.prototype,"listMode",void 0),i([u({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:se}},overridePolicy(e,t,n){return{enabled:!0,allowNull:!1,ignoreOrigin:lt(this,n==null?void 0:n.origin)&&dt(e)&&!!e.georeference&&e.originIdOf("georeference")>te.PORTAL_ITEM}}}}})],g.prototype,"source",null),i([Kt("source")],g.prototype,"castSource",null),i([ne("source",["url"])],g.prototype,"readSource",null),i([re("source")],g.prototype,"writeSource",null),i([u()],g.prototype,"spatialReference",void 0),i([u({readOnly:!0})],g.prototype,"type",void 0),g=i([P("esri.layers.MediaLayer")],g);const go=g;export{go as default};
