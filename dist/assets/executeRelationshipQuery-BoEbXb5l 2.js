import{f as p}from"./utils-Bh8BC7JY.js";import{U as f,co as y}from"./index-BdXiYUWp.js";import{t as j}from"./query-CpvlvXmT.js";import{d as R}from"./FeatureSet-DfoJg6qh.js";import{d as u}from"./labelingInfo-DP2-zXGg.js";import"./normalizeUtils-BACmLuYb.js";import"./normalizeUtilsCommon-DnAXcLGn.js";import"./utils-BllU-TlI.js";import"./pbfQueryUtils-Cv7uCooV.js";import"./pbf-PJcJHQe7.js";import"./OptimizedFeature-D3320lj0.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./queryZScale-DeuR5Lm5.js";import"./zscale-Q26ExEVF.js";import"./Field-16BWPiq_.js";import"./fieldType-D7m7V0MI.js";import"./labelUtils-0IYXgAnp.js";import"./uuid-Cl5lrJ4c.js";import"./Query-DDxQ_xPE.js";import"./TimeExtent-DKc53fFR.js";import"./layerUtils-CRmrchQW.js";import"./jsonUtils-CNNEUpfK.js";import"./UniqueValueRenderer-B2SL9Qlr.js";import"./RendererLegendOptions-CSIkgEnl.js";import"./diffUtils-BNnLMjfO.js";import"./enums-BoehirYs.js";import"./colorRamps-C5iTdYfo.js";import"./compilerUtils-B5rIYOON.js";import"./lengthUtils-CE2XSnNx.js";import"./styleUtils-CV5RL6ze.js";import"./defaults-C0xTDeSo.js";import"./defaultsJSON-GKolV7NZ.js";import"./LRUCache-C1crbGkZ.js";import"./Version-CbmqbzHg.js";import"./FieldsIndex-C2YFsm16.js";import"./colorUtils-C14RyZjC.js";import"./vec42-CwZz9wN3.js";import"./common-DokbeE9L.js";import"./vec4f64-CMoMXWBi.js";import"./heatmapUtils-BHUsg2yN.js";function F(e,o){const t=e.toJSON();return t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.orderByFields&&(t.orderByFields=t.orderByFields.join(",")),t.outFields&&!(o!=null&&o.returnCountOnly)?t.outFields.includes("*")?t.outFields="*":t.outFields=t.outFields.join(","):delete t.outFields,t.outSR&&(t.outSR=y(t.outSR)),t.dynamicDataSource&&(t.layer=JSON.stringify({source:t.dynamicDataSource}),delete t.dynamicDataSource),t}async function b(e,o,t){const i=await l(e,o,t),r=i.data,a=r.geometryType,n=r.spatialReference,s={};for(const c of r.relatedRecordGroups){const m={fields:void 0,objectIdFieldName:void 0,geometryType:a,spatialReference:n,hasZ:!!r.hasZ,hasM:!!r.hasM,features:c.relatedRecords};if(c.objectId!=null)s[c.objectId]=m;else for(const d of Object.keys(c))d!=="relatedRecords"&&(s[c[d]]=m)}return{...i,data:s}}async function h(e,o,t){const i=await l(e,o,t,{returnCountOnly:!0}),r=i.data,a={};for(const n of r.relatedRecordGroups)n.objectId!=null&&(a[n.objectId]=n.count);return{...i,data:a}}async function l(e,o,t={},i){const r=j({...e.query,f:"json",...i,...F(o,i)});return f(e.path+"/queryRelatedRecords",{...t,query:{...t.query,...r}})}async function st(e,o,t){o=u.from(o);const i=p(e);return b(i,o,t).then(r=>{const a=r.data,n={};return Object.keys(a).forEach(s=>n[s]=R.fromJSON(a[s])),n})}async function ct(e,o,t){o=u.from(o);const i=p(e);return h(i,o,{...t}).then(r=>r.data)}export{st as executeRelationshipQuery,ct as executeRelationshipQueryForCount};
