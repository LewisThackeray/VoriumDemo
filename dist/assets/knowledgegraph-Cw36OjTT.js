const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-fpRYQhW3.js","assets/index-BdXiYUWp.js","assets/index-DGW5n9KZ.css","assets/Relationship-DU6fkpdy.js"])))=>i.map(i=>d[i]);
import{P as K,co as I,aI as D,X as w,Z as R,a2 as M,d8 as C,U as L,b as N,_ as E,n as T,ai as U,a7 as z,g as J,dg as B}from"./index-BdXiYUWp.js";import{t as W,a as m,r as d,V as X,d as b,P as v,ao as Y,Y as Z,N as j,E as x,Q as H,z as G,S as k,G as tt,F as et,ap as rt,aq as O,ar as nt}from"./arcadeUtils-CELcDtXT.js";import{l as at}from"./portalUtils-Ct5_mM7H.js";import{W as ot,K as it,_ as st}from"./projection-sPm_KXQG.js";import pt from"./PortalItem-B5IuGMHV.js";import{f as ft,i as ut}from"./utils-Bh8BC7JY.js";import{o as lt}from"./utils-BllU-TlI.js";import{s as ct,m as mt,t as dt,p as ht,c as gt}from"./Relationship-DU6fkpdy.js";import"./TimeOnly-B9qcafr2.js";import"./FieldsIndex-C2YFsm16.js";import"./Field-16BWPiq_.js";import"./fieldType-D7m7V0MI.js";import"./number-B_Qb_B9Y.js";import"./Query-DDxQ_xPE.js";import"./TimeExtent-DKc53fFR.js";import"./featureConversionUtils-DtkYhb8p.js";import"./OptimizedFeature-D3320lj0.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./uuid-Cl5lrJ4c.js";import"./projectBuffer-CHV26hzf.js";import"./zscale-Q26ExEVF.js";let l=class extends K{constructor(t){super(t),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const t=this.geometries.map(o=>o.toJSON()),e=this.geometries[0],n={};return n.outSR=I(this.outSpatialReference),n.inSR=I(e.spatialReference),n.geometries=JSON.stringify({geometryType:D(e),geometries:t}),this.transformation&&(n.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(n.transformForward=this.transformForward),n}};w([R()],l.prototype,"geometries",void 0),w([R({json:{read:{source:"outSR"}}})],l.prototype,"outSpatialReference",void 0),w([R()],l.prototype,"transformation",void 0),w([R()],l.prototype,"transformForward",void 0),l=w([M("esri.rest.support.ProjectParameters")],l);const A=l,wt=C(A);async function yt(t,e,n){e=wt(e);const o=ft(t),i={...o.query,f:"json",...e.toJSON()},r=e.outSpatialReference,a=D(e.geometries[0]),p=ut(i,n);return L(o.path+"/project",p).then(({data:{geometries:f}})=>lt(f,a,r))}let h=null;async function St(t){const e=z.geometryServiceUrl??"";if(!e){st()||await ot();for(const r of t)r.container[r.indexer]=it(r.container[r.indexer],J.WGS84);return}const n=t.map(r=>r.container[r.indexer]),o=new A({geometries:n,outSpatialReference:J.WGS84}),i=await yt(e,o);for(let r=0;r<i.length;r++){const a=t[r];a.container[a.indexer]=i[r]}}async function q(t,e){const n=new pt({portal:t,id:e});return await n.load(),h===null&&(h=await E(()=>import("./knowledgeGraphService-fpRYQhW3.js").then(o=>o.k),__vite__mapDeps([0,1,2,3]))),await h.fetchKnowledgeGraph(n.url)}function P(t,e,n,o,i){if(t===null)return null;if(v(t)||G(t))return t;if(k(t)||k(t))return t.toJSDate();if(tt(t))return t.toStorageFormat();if(et(t))return t.toStorageString();if(rt(t)){const r={};for(const a of t.keys())r[a]=P(t.field(a),e,n,o,i),r[a]instanceof T&&i.push({container:r,indexer:a});return r}if(x(t)){const r=t.map(a=>P(a,e,n,o,i));for(let a=0;a<r.length;a++)r[a]instanceof T&&i.push({container:r,indexer:a});return r}return O(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?U(t):t:void 0}function Rt(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return B(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new m(e,d.WrongSpatialReference,null)}function $(t,e){if(!t)return null;const n={};for(const o in t)n[o]=y(t[o],e);return n}function y(t,e){return t===null?null:x(t)?t.map(n=>y(n,e)):t instanceof mt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:$(t.properties,e)}:t instanceof dt?{graphType:"object",properties:$(t.properties,e)}:t instanceof ht?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:$(t.properties,e)}:t instanceof gt?{graphType:"path",path:t.path?t.path.map(n=>y(n,e)):null}:O(t)?Rt(t,e):v(t)||G(t)||nt(t)?t:null}function Vt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(o,i,r)=>{var p,f;if(W(r,2,2,e,n),r[0]===null)throw new m(e,d.PortalRequired,n);if(r[0]instanceof X){const c=b(r[1]);let g;return g=(p=e.services)!=null&&p.portal?e.services.portal:N.getDefault(),q(at(r[0],g),c)}if(v(r[0])===!1)throw new m(e,d.InvalidParameter,n);const a=b(r[0]);return q(((f=e.services)==null?void 0:f.portal)??N.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,n){return t.standardFunctionAsync(e,n,async(o,i,r)=>{var F;W(r,2,4,e,n);const a=r[0];if(!Y(a))throw new m(e,d.InvalidParameter,n);const p=r[1];if(!v(p))throw new m(e,d.InvalidParameter,n);h===null&&(h=await E(()=>import("./knowledgeGraphService-fpRYQhW3.js").then(s=>s.k),__vite__mapDeps([0,1,2,3])));let f=null;const c=Z(r[2],null);if(!(c instanceof j||c===null))throw new m(e,d.InvalidParameter,n);if(c){let s=[];f=P(c,!0,!1,e,s),s=s.filter(u=>!u.container[u.indexer].spatialReference.isWGS84),s.length>0&&await St(s)}const g=new ct({openCypherQuery:p,bindParameters:f});(((F=a==null?void 0:a.serviceDefinition)==null?void 0:F.currentVersion)??11.3)>11.2&&(g.outputSpatialReference=e.spatialReference);const Q=(await h.executeQueryStreaming(a,g)).resultRowsStream.getReader(),_=[];try{for(;;){const{done:s,value:u}=await Q.read();if(s)break;if(x(u))for(const S of u)_.push(y(S,e));else{const S=[];for(const V of u)S.push(y(u[V],e));_.push(S)}}}catch(s){throw s}return j.convertJsonToArcade(_,H(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Vt as registerFunctions};
