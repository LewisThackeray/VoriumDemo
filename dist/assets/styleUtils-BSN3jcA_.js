import{el as f,em as u,en as p,eo as x,V as w,ep as U,eq as j,aD as d,cL as $,er as F,x as h,es as v,s as m,m as T,y as q,bY as E,l as A,r as P,et as z,eu as V,ev as R,R as W,a6 as K,b as Q,U as Y,aa as _,ew as B,e as G}from"./index-DMwY2Yeh.js";import{b as C}from"./layerUtils-Co4QOtAn.js";import{S as H,u as J,c as O}from"./defaults-BtwZGStO.js";import{e as X,i as Z}from"./defaultsJSON-GKolV7NZ.js";f.fromSimpleMarkerSymbol(H);u.fromSimpleLineSymbol(J);p.fromSimpleFillSymbol(O);new x({symbolLayers:new w([new U({material:{color:X},edges:new j({size:$(1),color:new d(Z)})})])});const ee=new u({symbolLayers:new w([new F({material:{color:new d([0,0,0])},size:$(1)})])}),oe=new p({symbolLayers:new w([new U({outline:{color:new d([0,0,0]),size:$(1)}})])}),I="#useCIMFallbackSymbology()",c={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function ne(e,n=c){var i,y,S,g;if(!e)return{symbol:null};const{retainId:t=c.retainId,ignoreDrivers:o=c.ignoreDrivers,hasLabelingContext:r=c.hasLabelingContext,retainCIM:a=c.retainCIM,cimFallbackEnabled:l=c.cimFallbackEnabled}=n;let s=null;if(h(e)||e instanceof v)s=e.clone();else if(e.type==="cim"){const b=(y=(i=e.data)==null?void 0:i.symbol)==null?void 0:y.type;switch(b){case"CIMPointSymbol":s=a?e.clone():f.fromCIMSymbol(e);break;case"CIMLineSymbol":l&&(s=ee.clone(),(S=n==null?void 0:n.logWarning)==null||S.call(n,I,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":l&&(s=oe.clone(),(g=n==null?void 0:n.logWarning)==null||g.call(n,I,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!s)return{error:new m("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${b||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof T)s=u.fromSimpleLineSymbol(e);else if(e instanceof q)s=f.fromSimpleMarkerSymbol(e);else if(e instanceof E)s=f.fromPictureMarkerSymbol(e);else if(e instanceof A)s=n.geometryType&&n.geometryType==="mesh"?x.fromSimpleFillSymbol(e):p.fromSimpleFillSymbol(e);else{if(!(e instanceof P))return{error:new m("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};s=r?z.fromTextSymbol(e):f.fromTextSymbol(e)}return t&&s&&s.type!=="cim"&&(s.id=e.id),o&&h(s)&&s.symbolLayers.forEach(b=>b.ignoreDrivers=!0),{symbol:s}}function fe(e,n,t,o){const r=N(e,{},{context:o,isLabelSymbol:!1});r!=null&&(n[t]=r)}function be(e,n,t,o){const r=N(e,{},{context:o,isLabelSymbol:!0});r!=null&&(n[t]=r)}function M(e){return e instanceof R||e instanceof v}function se(e){return e instanceof R&&(e.type==="polygon-3d"||e.type==="line-3d")}function N(e,n,t){var s;if(e==null)return null;const{context:o,isLabelSymbol:r}=t,a=o==null?void 0:o.origin,l=o==null?void 0:o.messages;if(a==="web-scene"&&!M(e)){const i=ne(e,{retainCIM:!0,hasLabelingContext:r});return i.symbol!=null?i.symbol.write(n,o):(l==null||l.push(new m("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:o,error:i.error})),null)}return C(o==null?void 0:o.layer)&&se(e)?(l==null||l.push(new m("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported on layers of type '${(s=o==null?void 0:o.layer)==null?void 0:s.declaredClass}'.`,{symbol:e,context:o})),null):(a==="web-map"||a==="portal-item"&&!C(o==null?void 0:o.layer))&&M(e)?(l==null||l.push(new m("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:o})),null):e.write(n,o)}function ue(e,n){return V(e,null,n)}const D=new Map;async function te(e,n){try{return{data:(await ae(e,n)).data,baseUrl:W(e),styleUrl:e}}catch(t){return K(t),null}}function re(e,n,t){var i;const o=n.portal!=null?n.portal:Q.getDefault();let r;const a=`${o.url} - ${(i=o.user)==null?void 0:i.username} - ${e}`,l=D.get(a);if(l)return l;const s=le(e,o,t).then(y=>(r=y,y.fetchData())).then(y=>({data:y,baseUrl:r.itemUrl??"",styleName:e}));return D.set(a,s),s}function le(e,n,t){return n.load(t).then(()=>{const o=new B({disableExtraQuery:!0,query:`owner:${L} AND type:${k} AND typekeywords:"${e}"`});return n.queryItems(o,t)}).then(({results:o})=>{var l;let r=null;const a=e.toLowerCase();if(o&&Array.isArray(o)){for(const s of o)if(((l=s.typeKeywords)==null?void 0:l.some(y=>y.toLowerCase()===a))&&s.type===k&&s.owner===L){r=s;break}}if(!r)throw new m("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return r.load(t)})}function pe(e,n,t){return(e==null?void 0:e.styleUrl)!=null?te(e.styleUrl,t):(e==null?void 0:e.styleName)!=null?re(e.styleName,n,t):Promise.reject(new m("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function we(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function de(e,n,t=["gltf"]){if(n==="cimRef")return encodeURI(e.cimRef);if(e.formatInfos&&!G("enable-feature:force-wosr"))for(const o of t){const r=e.formatInfos.find(a=>a.type===o);if(r)return r.href}return encodeURI(e.webRef)}function ae(e,n){const t={responseType:"json",query:{f:"json"},...n};return Y(_(e),t)}const L="esri_en",k="Style",$e="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{ue as a,be as b,$e as h,pe as i,fe as l,we as m,ae as p,de as y};
