const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/symbolLayerUtils-BngLAHSr.js","assets/index-BdXiYUWp.js","assets/index-DGW5n9KZ.css","assets/LRUCache-C1crbGkZ.js"])))=>i.map(i=>d[i]);
import{aD as a,x as f,dN as m,dO as g,dP as P,_ as L,dQ as x}from"./index-BdXiYUWp.js";import"./BlendLayer-D4vXfHoH.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-BmVJLnp_.js";import{y as w,f as z,m as d,M,I as C}from"./diffUtils-BNnLMjfO.js";import{e as $}from"./LRUCache-C1crbGkZ.js";function j(o){const t=[];return y(w(o),t),t.length?new a(z(t[0])):null}function y(o,t){var l;if(!o)return;let e;e=o.type==="CIMTextSymbol"?o.symbol:o;const r=o.type==="CIMPolygonSymbol";if(e!=null&&e.symbolLayers){for(const n of e.symbolLayers)if(!(n.colorLocked||r&&(d(n)||M(n)&&n.markerPlacement&&C(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&k(t,n.tintColor);break;case"CIMVectorMarker":(l=n.markerGraphics)==null||l.forEach(c=>{y(c.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":k(t,n.color);break;case"CIMHatchFill":y(n.lineSymbol,t)}}}function k(o,t){for(const e of o)if(e.join(".")===t.join("."))return;o.push(t)}function J(o,t,e){t instanceof a||(t=new a(t));const r=w(o);r&&h(r,t)}function h(o,t,e){var n;if(!o)return;let r;r=o.type==="CIMTextSymbol"?o.symbol:o;const l=(r==null?void 0:r.type)==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers)for(const c of r.symbolLayers){if(c.colorLocked||l&&(d(c)||M(c)&&c.markerPlacement&&C(c.markerPlacement)))continue;const s=t.toArray();switch(c.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":c.tintColor=s;break;case"CIMVectorMarker":(n=c.markerGraphics)==null||n.forEach(i=>{h(i.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":c.color=s;break;case"CIMHatchFill":h(c.lineSymbol,t)}}}new $(1e3);new a([128,128,128]);new a("white");function K(o,t){if(!o)return null;let e=null;return f(o)?e=E(o):m(o)&&(e=o.type==="cim"?j(o):o.color?new a(o.color):null),e?b(e,t):null}function E(o){const t=o.symbolLayers;if(!t)return null;let e=null;return t.forEach(r=>{var l;r.type==="object"&&((l=r.resource)!=null&&l.href)||(e=r.type==="water"?r.color:r.material?r.material.color:null)}),e?new a(e):null}function b(o,t){if(t==null||o==null)return o;const e=o.toRgba();return e[3]=e[3]*t,new a(e)}function _(o,t,e){const r=o.symbolLayers;if(!r)return;const l=n=>b(t=t??n??null,e);r.forEach(n=>{var c;if(n.type!=="object"||!((c=n.resource)!=null&&c.href)||t)if(n.type==="water")n.color=l(n.color);else{const s=n.material!=null?n.material.color:null,i=l(s);n.material==null?n.material=new x({color:i}):n.material.color=i}})}function v(o,t,e){(t=t??o.color)&&(o.color=b(t,e))}function W(o,t,e){o&&(t||e!=null)&&(t&&(t=new a(t)),f(o)?_(o,t,e):m(o)&&v(o,t,e))}async function F(o,t){const e=o.symbolLayers;e&&await g(e,async r=>O(r,t))}async function O(o,t){switch(o.type){case"extrude":D(o,t);break;case"icon":case"line":case"text":R(o,t);break;case"path":V(o,t);break;case"object":await T(o,t)}}function R(o,t){const e=I(t);e!=null&&(o.size=e)}function I(o){for(const t of o)if(typeof t=="number")return t;return null}function D(o,t){o.size=typeof t[2]=="number"?t[2]:0}async function T(o,t){const{resourceSize:e,symbolSize:r}=await A(o),l=S(t,e,r);o.width=u(t[0],r[0],e[0],l),o.depth=u(t[1],r[1],e[1],l),o.height=u(t[2],r[2],e[2],l)}function V(o,t){const e=S(t,P,[o.width,void 0,o.height]);o.width=u(t[0],o.width,1,e),o.height=u(t[2],o.height,1,e)}function S(o,t,e){for(let r=0;r<3;r++){const l=o[r];switch(l){case"symbol-value":{const n=e[r];return n!=null?n/t[r]:1}case"proportional":break;default:if(l&&t[r])return l/t[r]}}return 1}async function A(o){const{computeObjectLayerResourceSize:t}=await L(()=>import("./symbolLayerUtils-BngLAHSr.js"),__vite__mapDeps([0,1,2,3])),e=await t(o,10),{width:r,height:l,depth:n}=o,c=[r,n,l];let s=1;for(let i=0;i<3;i++){const p=c[i];if(p!=null){s=p/e[i];break}}for(let i=0;i<3;i++)c[i]==null&&(c[i]=e[i]*s);return{resourceSize:e,symbolSize:c}}function u(o,t,e,r){switch(o){case"proportional":return e*r;case"symbol-value":return t??e;default:return o}}function G(o,t){const e=I(t);if(e!=null)switch(o.type){case"simple-marker":o.size=e;break;case"picture-marker":{const r=o.width/o.height;r>1?(o.width=e,o.height=e*r):(o.width=e*r,o.height=e);break}case"simple-line":o.width=e;break;case"text":o.font.size=e}}async function X(o,t){if(o&&t)return f(o)?F(o,t):void(m(o)&&G(o,t))}function Y(o,t,e){if(o&&t!=null)if(f(o)){const r=o.symbolLayers;r&&r.forEach(l=>{if(l.type==="object")switch(e){case"tilt":l.tilt=(l.tilt??0)+t;break;case"roll":l.roll=(l.roll??0)+t;break;default:l.heading=(l.heading??0)+t}l.type==="icon"&&(l.angle+=t)})}else m(o)&&(o.type!=="simple-marker"&&o.type!=="picture-marker"&&o.type!=="text"||(o.angle+=t))}export{Y as D,J as I,X as R,W as g,K as h};
