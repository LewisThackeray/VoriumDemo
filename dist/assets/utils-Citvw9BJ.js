import{d as q}from"./ClassBreaksDefinition-B7ob1ckT.js";import{t as C}from"./index-BdXiYUWp.js";const w=()=>C.getLogger("esri.rest.support.generateRendererUtils");function v(t,n){return Number(t.toFixed(n))}function E(t){const{normalizationTotal:n}=t;return{classBreaks:B(t),normalizationTotal:n}}function B(t){const n=t.definition,{classificationMethod:e,normalizationType:l,definedInterval:i}=n,o=n.breakCount??1,r=[];let a=t.values;if(a.length===0)return[];a=a.sort((f,d)=>f-d);const m=a[0],p=a[a.length-1];if(e==="equal-interval")if(a.length>=o){const f=(p-m)/o;let d=m;for(let s=1;s<o;s++){const u=v(m+s*f,6);r.push({minValue:d,maxValue:u,label:b(d,u,l)}),d=u}r.push({minValue:d,maxValue:p,label:b(d,p,l)})}else a.forEach(f=>{r.push({minValue:f,maxValue:f,label:b(f,f,l)})});else if(e==="natural-breaks"){const f=O(a),d=t.valueFrequency||f.valueFrequency,s=U(f.uniqueValues,d,o);let u=m;for(let c=1;c<o;c++)if(f.uniqueValues.length>c){const h=v(f.uniqueValues[s[c]],6);r.push({minValue:u,maxValue:h,label:b(u,h,l)}),u=h}r.push({minValue:u,maxValue:p,label:b(u,p,l)})}else if(e==="quantile")if(a.length>=o&&m!==p){let f=m,d=Math.ceil(a.length/o),s=0;for(let u=1;u<o;u++){let c=d+s-1;c>a.length&&(c=a.length-1),c<0&&(c=0),r.push({minValue:f,maxValue:a[c],label:b(f,a[c],l)}),f=a[c],s+=d,d=Math.ceil((a.length-s)/(o-u))}r.push({minValue:f,maxValue:p,label:b(f,p,l)})}else{let f=-1;for(let d=0;d<a.length;d++){const s=a[d];s!==f&&(f=s,r.push({minValue:f,maxValue:s,label:b(f,s,l)}),f=s)}}else if(e==="standard-deviation"){const f=G(a),d=A(a,f);if(d===0)r.push({minValue:a[0],maxValue:a[0],label:b(a[0],a[0],l)});else{const s=L(m,p,o,f,d)*d;let u=0,c=m;for(let g=o;g>=1;g--){const V=v(f-(g-.5)*s,6);r.push({minValue:c,maxValue:V,label:b(c,V,l)}),c=V,u++}let h=v(f+.5*s,6);r.push({minValue:c,maxValue:h,label:b(c,h,l)}),c=h,u++;for(let g=1;g<=o;g++)h=u===2*o?p:v(f+(g+.5)*s,6),r.push({minValue:c,maxValue:h,label:b(c,h,l)}),c=h,u++}}else if(e==="defined-interval"){if(!i)return r;const f=a[0],d=a[a.length-1],s=Math.ceil((d-f)/i);let u=f;for(let c=1;c<s;c++){const h=v(f+c*i,6);r.push({minValue:u,maxValue:h,label:b(u,h,l)}),u=h}r.push({minValue:u,maxValue:d,label:b(u,d,l)})}return r}function b(t,n,e){let l=null;return l=t===n?e&&e==="percent-of-total"?t+"%":t.toString():e&&e==="percent-of-total"?t+"% - "+n+"%":t+" - "+n,l}function O(t){const n=[],e=[];let l=Number.MIN_VALUE,i=1,o=-1;for(let r=0;r<t.length;r++){const a=t[r];a===l?(i++,e[o]=i):a!==null&&(n.push(a),l=a,i=1,e.push(i),o++)}return{uniqueValues:n,valueFrequency:e}}function U(t,n,e){const l=t.length,i=[];e>l&&(e=l);for(let r=0;r<e;r++)i.push(Math.round(r*l/e-1));i.push(l-1);let o=I(i,t,n,e);return P(o.mean,o.sdcm,i,t,n,e)&&(o=I(i,t,n,e)),i}function I(t,n,e,l){let i=[],o=[],r=[],a=0;const m=[],p=[];for(let u=0;u<l;u++){const c=x(u,t,n,e);m.push(c.sbMean),p.push(c.sbSdcm),a+=p[u]}let f,d=a,s=!0;for(;s||a<d;){s=!1,i=[];for(let u=0;u<l;u++)i.push(t[u]);for(let u=0;u<l;u++)for(let c=t[u]+1;c<=t[u+1];c++)if(f=n[c],u>0&&c!==t[u+1]&&Math.abs(f-m[u])>Math.abs(f-m[u-1]))t[u]=c;else if(u<l-1&&t[u]!==c-1&&Math.abs(f-m[u])>Math.abs(f-m[u+1])){t[u+1]=c-1;break}d=a,a=0,o=[],r=[];for(let u=0;u<l;u++){o.push(m[u]),r.push(p[u]);const c=x(u,t,n,e);m[u]=c.sbMean,p[u]=c.sbSdcm,a+=p[u]}}if(a>d){for(let u=0;u<l;u++)t[u]=i[u],m[u]=o[u],p[u]=r[u];a=d}return{mean:m,sdcm:p}}function P(t,n,e,l,i,o){let r=0,a=0,m=0,p=0,f=!0;for(let d=0;d<2&&f;d++){d===0&&(f=!1);for(let s=0;s<o-1;s++)for(;e[s+1]+1!==e[s+2];){e[s+1]=e[s+1]+1;const u=x(s,e,l,i);m=u.sbMean,r=u.sbSdcm;const c=x(s+1,e,l,i);if(p=c.sbMean,a=c.sbSdcm,!(r+a<n[s]+n[s+1])){e[s+1]=e[s+1]-1;break}n[s]=r,n[s+1]=a,t[s]=m,t[s+1]=p,f=!0}for(let s=o-1;s>0;s--)for(;e[s]!==e[s-1]+1;){e[s]=e[s]-1;const u=x(s-1,e,l,i);m=u.sbMean,r=u.sbSdcm;const c=x(s,e,l,i);if(p=c.sbMean,a=c.sbSdcm,!(r+a<n[s-1]+n[s])){e[s]=e[s]+1;break}n[s-1]=r,n[s]=a,t[s-1]=m,t[s]=p,f=!0}}return f}function L(t,n,e,l,i){let o=Math.max(l-t,n-l)/i/e;return o=o>=1?1:o>=.5?.5:.25,o}function G(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n/=t.length,n}function A(t,n){let e=0;for(let l=0;l<t.length;l++){const i=t[l];e+=(i-n)*(i-n)}return e/=t.length,Math.sqrt(e)}function x(t,n,e,l){let i=0,o=0;for(let m=n[t]+1;m<=n[t+1];m++){const p=l[m];i+=e[m]*p,o+=p}o<=0&&w().warn("Exception in Natural Breaks calculation");const r=i/o;let a=0;for(let m=n[t]+1;m<=n[t+1];m++)a+=l[m]*(e[m]-r)**2;return{sbMean:r,sbSdcm:a}}const _="<Null>",Y="equal-interval",j=1,Q=5,R=10,H=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,J=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),K=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),W=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function T(t){return t==null||typeof t=="string"&&!t?_:t}function X(t){const n=t.normalizationField!=null||t.normalizationType!=null,e=t.minValue!=null||t.maxValue!=null,l=!!t.sqlExpression&&t.supportsSQLExpression;return!n&&!e&&!l}function Vt(t){var r,a;const{outStatisticTypes:n}=t,e=t.returnDistinct?[...new Set(t.values)]:t.values,l=e.filter(m=>m!=null).sort(),i=l.length,o={count:i,min:l[0],max:l[i-1]};return t.supportsNullCount&&(o.nullcount=e.length-i),!t.percentileParams||(r=n==null?void 0:n.include)!=null&&r.length&&!n.include.includes("median")||(a=n==null?void 0:n.exclude)!=null&&a.length&&n.exclude.includes("median")||(o.median=N(e,t.percentileParams)),o}function Z(t){var h,g;const{values:n,useSampleStdDev:e,supportsNullCount:l,outStatisticTypes:i}=t;let o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,a=null,m=null,p=null,f=null,d=0;const s=t.minValue==null?-1/0:t.minValue,u=t.maxValue==null?1/0:t.maxValue;for(const V of n)Number.isFinite(V)?V>=s&&V<=u&&(a=a===null?V:a+V,o=Math.min(o,V),r=Math.max(r,V),d++):typeof V=="string"&&d++;if(d&&a!=null){m=a/d;let V=0;for(const y of n)Number.isFinite(y)&&y>=s&&y<=u&&(V+=(y-m)**2);f=e?d>1?V/(d-1):0:d>0?V/d:0,p=Math.sqrt(f)}else o=null,r=null;const c={avg:m,count:d,max:r,min:o,stddev:p,sum:a,variance:f};return l&&(c.nullcount=n.length-d),!t.percentileParams||(h=i==null?void 0:i.include)!=null&&h.length&&!i.include.includes("median")||(g=i==null?void 0:i.exclude)!=null&&g.length&&i.exclude.includes("median")||(c.median=N(n,t.percentileParams)),c}function N(t,n){const{fieldType:e,value:l,orderBy:i,isDiscrete:o}=n,r=tt(e,i==="desc");if((t=[...t].filter(u=>u!=null).sort((u,c)=>r(u,c))).length===0)return null;if(l<=0)return t[0];if(l>=1)return t[t.length-1];const a=(t.length-1)*l,m=Math.floor(a),p=m+1,f=a%1,d=t[m],s=t[p];return p>=t.length||o||typeof d=="string"||typeof s=="string"?d:d*(1-f)+s*f}function tt(t,n){if(t){if(J.has(t))return D(n);if(K.has(t))return z(n,!1);if(t==="esriFieldTypeTimestampOffset")return lt(n);const r=z(n,!0);if(t==="esriFieldTypeString")return r;if(t==="esriFieldTypeGUID"||t==="esriFieldTypeGlobalID")return(a,m)=>r($(a),$(m))}const e=n?1:-1,l=D(n),i=z(n,!0),o=k(n);return(r,a)=>typeof r=="number"&&typeof a=="number"?l(r,a):typeof r=="string"&&typeof a=="string"?i(r,a):o(r,a)??e}const F=(t,n)=>t==null?n==null?0:1:n==null?-1:null,M=(t,n)=>t==null?n==null?0:-1:n==null?1:null;function k(t){return t?F:M}const nt=(t,n)=>M(t,n)??(t===n?0:new Date(t).getTime()-new Date(n).getTime()),et=(t,n)=>F(t,n)??(t===n?0:new Date(n).getTime()-new Date(t).getTime());function lt(t){return t?et:nt}const at=(t,n)=>M(t,n)??(t===n?0:t<n?-1:1),it=(t,n)=>F(t,n)??(t===n?0:t<n?1:-1);function z(t,n){if(!n)return t?it:at;const e=k(t);return t?(l,i)=>{const o=e(l,i);return o??((l=l.toUpperCase())>(i=i.toUpperCase())?-1:l<i?1:0)}:(l,i)=>{const o=e(l,i);return o??((l=l.toUpperCase())<(i=i.toUpperCase())?-1:l>i?1:0)}}const ut=(t,n)=>F(t,n)??n-t,ot=(t,n)=>M(t,n)??t-n;function D(t){return t?ut:ot}function $(t){return t.slice(24,36)+t.slice(19,23)+t.slice(16,18)+t.slice(14,16)+t.slice(11,13)+t.slice(9,11)+t.slice(6,8)+t.slice(4,6)+t.slice(2,4)+t.slice(0,2)}function bt(t,n,e){var i,o;let l;for(l in t)(i=n==null?void 0:n.include)!=null&&i.length&&!n.include.includes(l)||(o=n==null?void 0:n.exclude)!=null&&o.length&&n.exclude.includes(l)?delete t[l]:W.includes(l)&&(Number.isFinite(t[l])||(t[l]=null));return e&&["avg","stddev","variance"].forEach(r=>{t[r]!=null&&(t[r]=Math.ceil(t[r]??0))}),t}function gt(t){const n={};for(let e of t)(e==null||typeof e=="string"&&e.trim()==="")&&(e=null),n[e]==null?n[e]={count:1,data:e}:n[e].count++;return{count:n}}function S(t){return(t==null?void 0:t.type)!=="coded-value"?[]:t.codedValues.map(n=>n.code)}function vt(t,n,e,l){const i=t.count,o=[];if(e&&n){const r=[],a=S(n[0]);for(const m of a)if(n[1]){const p=S(n[1]);for(const f of p)if(n[2]){const d=S(n[2]);for(const s of d)r.push(`${T(m)}${l}${T(f)}${l}${T(s)}`)}else r.push(`${T(m)}${l}${T(f)}`)}else r.push(m);for(const m of r)i.hasOwnProperty(m)||(i[m]={data:m,count:0})}for(const r in i){const a=i[r];o.push({value:a.data,count:a.count,label:a.label})}return{uniqueValueInfos:o}}function xt(t,n,e,l){let i=null;switch(n){case"log":t!==0&&(i=Math.log(t)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(l)&&l!==0&&(i=t/l*100);break;case"field":Number.isFinite(e)&&e!==0&&(i=t/e);break;case"natural-log":t>0&&(i=Math.log(t));break;case"square-root":t>0&&(i=t**.5)}return i}function rt(t,n){const e=ct({field:n.field,normalizationType:n.normalizationType,normalizationField:n.normalizationField,classificationMethod:n.classificationMethod,standardDeviationInterval:n.standardDeviationInterval,breakCount:n.numClasses||Q});return t=st(t,n.minValue,n.maxValue),E({definition:e,values:t,normalizationTotal:n.normalizationTotal})}function st(t,n,e){const l=n??-1/0,i=e??1/0;return t.filter(o=>Number.isFinite(o)&&o>=l&&o<=i)}function ct(t){const{breakCount:n,field:e,normalizationField:l,normalizationType:i}=t,o=t.classificationMethod||Y,r=o==="standard-deviation"?t.standardDeviationInterval||j:void 0,a=o==="defined-interval"?t.definedInterval:void 0;return new q({breakCount:n,classificationField:e,classificationMethod:o,normalizationField:i==="field"?l:void 0,normalizationType:i,standardDeviationInterval:r,definedInterval:a})}function Tt(t,n){var m,p;let e=t.classBreaks;const l=e.length,i=(m=e[0])==null?void 0:m.minValue,o=(p=e[l-1])==null?void 0:p.maxValue,r=n==="standard-deviation",a=H;return e=e.map(f=>{const d=f.label,s={minValue:f.minValue,maxValue:f.maxValue,label:d};if(r&&d){const u=d.match(a),c=(u==null?void 0:u.map(h=>+h.trim()))??[];c.length===2?(s.minStdDev=c[0],s.maxStdDev=c[1],c[0]<0&&c[1]>0&&(s.hasAvg=!0)):c.length===1&&(d.includes("<")?(s.minStdDev=null,s.maxStdDev=c[0]):d.includes(">")&&(s.minStdDev=c[0],s.maxStdDev=null))}return s}),{minValue:i,maxValue:o,classBreakInfos:e,normalizationTotal:t.normalizationTotal}}function yt(t,n){const e=mt(t,n);if(e.min==null&&e.max==null)return{bins:[],minValue:e.min,maxValue:e.max,normalizationTotal:n.normalizationTotal};const l=e.intervals,i=e.min??0,o=e.max??0,r=l.map((a,m)=>({minValue:l[m][0],maxValue:l[m][1],count:0}));for(const a of t)if(a!=null&&a>=i&&a<=o){const m=ft(l,a);m>-1&&r[m].count++}return{bins:r,minValue:i,maxValue:o,normalizationTotal:n.normalizationTotal}}function mt(t,n){const{field:e,classificationMethod:l,standardDeviationInterval:i,normalizationType:o,normalizationField:r,normalizationTotal:a,minValue:m,maxValue:p}=n,f=n.numBins||R;let d=null,s=null,u=null;if((!l||l==="equal-interval")&&!o){if(m!=null&&p!=null)d=m,s=p;else{const c=Z({values:t,minValue:m,maxValue:p,useSampleStdDev:!o,supportsNullCount:X({normalizationType:o,normalizationField:r,minValue:m,maxValue:p})});d=c.min??null,s=c.max??null}u=dt(d??0,s??0,f)}else{const{classBreaks:c}=rt(t,{field:e,normalizationType:o,normalizationField:r,normalizationTotal:a,classificationMethod:l,standardDeviationInterval:i,minValue:m,maxValue:p,numClasses:f});d=c[0].minValue,s=c[c.length-1].maxValue,u=c.map(h=>[h.minValue,h.maxValue])}return{min:d,max:s,intervals:u}}function ft(t,n){let e=-1;for(let l=t.length-1;l>=0;l--)if(n>=t[l][0]){e=l;break}return e}function dt(t,n,e){const l=(n-t)/e,i=[];let o,r=t;for(let a=1;a<=e;a++)o=r+l,o=Number(o.toFixed(16)),i.push([r,a===e?n:o]),r=o;return i}export{vt as $,xt as B,bt as C,rt as E,Tt as P,yt as U,X as d,Vt as f,tt as g,gt as k,T as m,Z as p,N as v};
